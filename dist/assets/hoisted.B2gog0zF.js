import"./hoisted.CP1yPtPt.js";import"./hoisted.9DTYW01u.js";import"./hoisted.BcFaeQLq.js";import"./LogoStrip.astro_astro_type_script_index_0_lang.C7R9LMze.js";class t{constructor(){this.apiEndpoint="https://sesec-backend.fly.dev/api/threat/data",this.refreshInterval=9e5,this.retryAttempts=3,this.retryDelay=5e3}animateCounter(t,e,r=2e3){const a=parseInt(t.textContent.replace(/[^0-9]/g,""))||0,o=performance.now();requestAnimationFrame(function s(n){const i=n-o,c=Math.min(i/r,1),d=(l=c,1-Math.pow(1-l,4));var l;const u=Math.floor(a+(e-a)*d);t.textContent=u.toLocaleString(),c<1&&requestAnimationFrame(s)})}drawSparkline(t,e){const r=t.getContext("2d"),a=t.width,o=t.height;if(r.clearRect(0,0,a,o),!e||0===e.length)return;const s=Math.max(...e),n=Math.min(...e),i=s-n||1,c=r.createLinearGradient(0,0,0,o);c.addColorStop(0,"rgba(59, 130, 246, 0.8)"),c.addColorStop(1,"rgba(59, 130, 246, 0.2)"),r.beginPath(),r.moveTo(2,o-2),e.forEach((t,s)=>{const c=2+s/(e.length-1)*(a-4),d=o-2-(t-n)/i*(o-4);r.lineTo(c,d)}),r.lineTo(a-2,o-2),r.closePath(),r.fillStyle=c,r.fill(),r.beginPath(),e.forEach((t,s)=>{const c=2+s/(e.length-1)*(a-4),d=o-2-(t-n)/i*(o-4);0===s?r.moveTo(c,d):r.lineTo(c,d)}),r.strokeStyle="rgba(59, 130, 246, 1)",r.lineWidth=1.5,r.stroke()}updateAPIStatus(t,e,r="free"){const a=document.querySelector(`[data-api="${t}"]`);if(!a)return;const o=a.querySelector(".status-indicator"),s=a.querySelector(".api-status");if(o&&o.setAttribute("data-status",e),s){s.setAttribute("data-status",e);let t="";switch(e){case"ok":t="ðŸŸ¢ Online";break;case"fallback":t="ðŸŸ¡ Simulated data";break;case"requires_token":t="ðŸ”‘ Requires token";break;case"error":t="ðŸ”´ Error";break;default:t="ðŸŸ¡ Loading..."}s.textContent=t}}hideLoadingStates(t){t.querySelectorAll(".loading-skeleton, .sparkline-loading, .port-loading").forEach(t=>{t.style.opacity="0",setTimeout(()=>t.style.display="none",300)})}updateCardData(t,e){const r=document.querySelector(`[data-api="${t}"]`);if(r){if(this.hideLoadingStates(r),e.error){this.updateAPIStatus(t,"error");const a=r.querySelector(".card-subtitle");return void(a&&(a.textContent=`Error: ${e.error}`))}switch(this.updateAPIStatus(t,"ok"),t){case"urlhaus":this.updateURLhausCard(r,e);break;case"cloudflare":this.updateCloudflareCard(r,e);break;case"sansISC":this.updateSANSISCCard(r,e);break;case"ransomwatch":this.updateRansomwatchCard(r,e)}}}updateURLhausCard(t,e){const r=t.querySelector(".counter"),a=t.querySelector(".card-subtitle"),o=t.querySelector(".sparkline");r&&void 0!==e.count&&this.animateCounter(r,e.count),a&&(a.textContent="Detected last 24h"),o&&e.trend&&this.drawSparkline(o,e.trend)}updateCloudflareCard(t,e){const r=t.querySelector(".counter"),a=t.querySelector(".card-subtitle"),o=t.querySelector(".sparkline");r&&void 0!==e.percentage&&this.animateCounter(r,e.percentage),a&&(a.textContent=`Top technique: ${e.topTechnique||"DDoS"}`),o&&e.trend&&this.drawSparkline(o,e.trend)}updateSANSISCCard(t,e){const r=t.querySelectorAll(".port-item"),a=t.querySelector(".sparkline");e.ports&&r.length>=3&&e.ports.slice(0,3).forEach((t,e)=>{if(r[e]){const a=r[e].querySelector(".port-number"),o=r[e].querySelector(".port-count");a&&(a.textContent=t.port),o&&(o.textContent=`(${this.formatNumber(t.count)})`)}}),a&&e.trend&&this.drawSparkline(a,e.trend)}updateRansomwatchCard(t,e){const r=t.querySelector(".counter"),a=t.querySelector(".card-subtitle"),o=t.querySelector(".sparkline");r&&void 0!==e.count&&this.animateCounter(r,e.count),a&&(a.textContent="Published last 24h"),o&&e.trend&&this.drawSparkline(o,e.trend)}formatNumber(t){return t>=1e6?(t/1e6).toFixed(1)+"M":t>=1e3?(t/1e3).toFixed(1)+"K":t.toString()}async fetchData(t=1){try{const t=await fetch(this.apiEndpoint,{method:"GET",headers:{Accept:"application/json","Cache-Control":"no-cache"}});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const e=await t.json();if(!e.success||!e.data)throw new Error(e.error||"Invalid API response");e.apis&&Object.entries(e.apis).forEach(([t,e])=>{this.updateAPIStatus(t,e.status,e.type)}),this.updateDashboard(e.data)}catch(e){console.error(`API fetch attempt ${t} failed:`,e),t<this.retryAttempts?setTimeout(()=>{this.fetchData(t+1)},this.retryDelay*t):this.handleAPIError(e)}}updateDashboard(t){t.apis&&Object.entries(t.apis).forEach(([t,e])=>{this.updateAPIStatus(t,e.status,e.type)}),Object.keys(t).forEach(e=>{t[e]&&"apis"!==e&&this.updateCardData(e,t[e])})}handleAPIError(t){console.error("Dashboard API Error:",t);document.querySelectorAll(".cyber-card").forEach(t=>{const e=t.getAttribute("data-api");if(e){this.updateAPIStatus(e,"error"),this.hideLoadingStates(t);const r=t.querySelector(".card-subtitle");r&&(r.textContent="Connection error - Retrying...")}})}animateCards(){document.querySelectorAll(".cyber-card").forEach((t,e)=>{t.style.opacity="0",t.style.transform="translateY(20px)",setTimeout(()=>{t.style.transition="all 0.6s cubic-bezier(0.4, 0, 0.2, 1)",t.style.opacity="1",t.style.transform="translateY(0)"},150*e)})}init(){this.animateCards(),setTimeout(()=>{this.fetchData()},1e3),setInterval(()=>{this.fetchData()},this.refreshInterval)}}document.addEventListener("DOMContentLoaded",function(){(new t).init()});
