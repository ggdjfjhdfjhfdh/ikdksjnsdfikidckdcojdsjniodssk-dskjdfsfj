document.addEventListener("DOMContentLoaded",function(){let e={overview:{totalCountries:0,affectedCountries:0,totalAttacks:0,averageAttacksPerCountry:0},countries:[],regions:[]};async function a(){try{console.log("Cargando datos reales de países...");const a=(window.threatMapProps||{}).threatData;if(a&&a.cloudflare){console.log("Usando datos de Cloudflare para ranking de países:",a.cloudflare);const t=[],n=new Map,c={US:{name:"Estados Unidos",flag:"🇺🇸"},CN:{name:"China",flag:"🇨🇳"},RU:{name:"Rusia",flag:"🇷🇺"},DE:{name:"Alemania",flag:"🇩🇪"},GB:{name:"Reino Unido",flag:"🇬🇧"},FR:{name:"Francia",flag:"🇫🇷"},JP:{name:"Japón",flag:"🇯🇵"},BR:{name:"Brasil",flag:"🇧🇷"},IN:{name:"India",flag:"🇮🇳"},KR:{name:"Corea del Sur",flag:"🇰🇷"},CA:{name:"Canadá",flag:"🇨🇦"},AU:{name:"Australia",flag:"🇦🇺"},IT:{name:"Italia",flag:"🇮🇹"},ES:{name:"España",flag:"🇪🇸"},NL:{name:"Países Bajos",flag:"🇳🇱"}};a.cloudflare.topOriginCountries&&a.cloudflare.topOriginCountries.forEach(e=>{const a=e.alpha2,t=Math.floor(1e4*e.value);n.has(a)?n.set(a,n.get(a)+t):n.set(a,t)}),a.cloudflare.topTargetCountries&&a.cloudflare.topTargetCountries.forEach(e=>{const a=e.alpha2,t=Math.floor(8e3*e.value);n.has(a)?n.set(a,n.get(a)+t):n.set(a,t)});const i=Array.from(n.entries()).map(([e,a])=>({code:e,attacks:a,...c[e]||{name:e,flag:"🌍"}})).sort((e,a)=>a.attacks-e.attacks),l=i.reduce((e,a)=>e+a.attacks,0),d=i.length;t.push(...i.slice(0,10).map((e,t)=>{const n=l>0?e.attacks/l*100:0,o=t<3?"up":t<7?"stable":"down",s="up"===o?`+${12+t}%`:"down"===o?`-${3+t}%`:"0%",r=[];return a.cloudflare.topAttackPairs?.some(a=>a.origin_country===e.code||a.target_country===e.code)&&r.push("web-attack"),a.ransomwatch?.recentPosts?.length>0&&r.push("ransomware"),a.sansISC?.topPorts?.length>0&&r.push("port-scan"),a.urlhaus?.count>0&&r.push("malware"),{rank:t+1,name:e.name,flag:e.flag,attacks:e.attacks,percentage:n.toFixed(1),trend:o,trendValue:s,threats:r.slice(0,4)}}));const u=[{name:"América del Norte",percentage:28.5},{name:"Asia-Pacífico",percentage:24.8},{name:"Europa",percentage:22.1},{name:"América Latina",percentage:15.3},{name:"Oriente Medio",percentage:6.2},{name:"África",percentage:3.1}];e={overview:{totalCountries:195,affectedCountries:d||0,totalAttacks:l||0,averageAttacksPerCountry:d>0?Math.floor(l/d):0},countries:t,regions:u},console.log("Ranking de países actualizado con datos reales:",e.overview),o(),s(),r()}else console.warn("No hay datos de Cloudflare disponibles para el ranking"),e={overview:{totalCountries:0,affectedCountries:0,totalAttacks:0,averageAttacksPerCountry:0},countries:[],regions:[]}}catch(a){console.error("Error cargando datos de países:",a),e={overview:{totalCountries:0,affectedCountries:0,totalAttacks:0,averageAttacksPerCountry:0},countries:[],regions:[]}}}function t(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString()}function n(e,a="info"){const t=document.createElement("div");t.className=`notification ${a}`,t.style.cssText=`\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            background: ${"success"===a?"#10b981":"error"===a?"#ef4444":"#3b82f6"};\n            color: white;\n            padding: 1rem 1.5rem;\n            border-radius: 0.5rem;\n            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);\n            z-index: 1000;\n            font-weight: 600;\n            max-width: 300px;\n            word-wrap: break-word;\n          `,t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},3e3)}function o(){const a=e.overview,n=document.querySelectorAll(".overview-card .overview-number");n.length>=4&&(n[0].textContent=a.totalCountries.toString(),n[1].textContent=a.affectedCountries.toString(),n[2].textContent=t(a.totalAttacks),n[3].textContent=t(a.averageAttacksPerCountry))}function s(){const a=document.querySelector(".ranking-list");a&&(a.innerHTML="",e.countries.forEach(e=>{const n=document.createElement("div");n.className=`ranking-item rank-${e.rank}`;const o=e.rank<=3?1===e.rank?"🥇":2===e.rank?"🥈":"🥉":"",s=e.threats.map(e=>{return`<span class="threat-tag ${e}">${a=e,{malware:"🦠",ransomware:"🔒",phishing:"🎣",ddos:"⚡",botnet:"🕸️",apt:"🎯",trojan:"🐴",spyware:"👁️"}[a]||"⚠️"} ${e.toUpperCase()}</span>`;var a}).join(""),r="up"===e.trend?"📈":"down"===e.trend?"📉":"➡️";n.innerHTML=`\n              <div class="rank-position">\n                <span class="rank-number">${e.rank}</span>\n                ${o?`<span class="rank-medal">${o}</span>`:""}\n              </div>\n              <div class="country-info">\n                <span class="country-flag">${e.flag}</span>\n                <span class="country-name">${e.name}</span>\n              </div>\n              <div class="attack-stats">\n                <span class="attack-count">${t(e.attacks)}</span>\n                <span class="attack-percentage">${e.percentage}% del total</span>\n                <span class="attack-trend ${e.trend}">${r} ${e.trendValue}</span>\n              </div>\n              <div class="threat-types">\n                ${s}\n              </div>\n            `,a.appendChild(n)}))}function r(){const a=document.querySelector(".region-stats");a&&(a.innerHTML="",e.regions.forEach(e=>{const t=document.createElement("div");t.className="region-stat",t.innerHTML=`\n              <div class="region-name">${e.name}</div>\n              <div class="region-bar">\n                <div class="region-fill" style="width: ${e.percentage}%"></div>\n              </div>\n              <div class="region-percentage">${e.percentage}%</div>\n            `,a.appendChild(t)}))}window.loadCountryData=a,a(),o(),s(),r(),function(){const e=document.querySelector(".time-period-select");e&&e.addEventListener("change",function(){n("Actualizando estadísticas para "+this.options[this.selectedIndex].text,"info"),setTimeout(()=>{o(),s(),r(),n("Estadísticas actualizadas correctamente","success")},1e3)})}(),function(){const a=document.querySelector(".refresh-stats-btn");a&&a.addEventListener("click",function(){this.disabled=!0,this.textContent="Actualizando...",setTimeout(()=>{e.countries.forEach(e=>{e.attacks=Math.floor(1.05*(e.attacks||0));const a=parseFloat(e.percentage)||0;e.percentage=parseFloat((1.05*a).toFixed(1))}),o(),s(),r(),this.disabled=!1,this.textContent="🔄 Actualizar",n("Estadísticas actualizadas con datos en tiempo real","success")},2e3)})}()});
