class e{constructor(){this.nav=document.getElementById("main-nav"),this.mobileToggle=document.getElementById("mobile-toggle"),this.mobileMenu=document.getElementById("mobile-menu"),this.langToggle=document.getElementById("lang-toggle"),this.langDropdown=document.getElementById("lang-dropdown"),this.lastScrollY=0,this.isMenuOpen=!1,this.lang=this.nav?.dataset.lang||"es",this.lblOpen="es"===this.lang?"Abrir menú":"Open menu",this.lblClose="es"===this.lang?"Cerrar menú":"Close menu",this.focusTrapHandler=null,this.prevFocus=null,this.init()}init(){this.setupScrollHandler(),this.setupMobileMenu(),this.setupLanguageSwitcher(),this.setupActiveLinks(),this.setupKeyboardNavigation()}setupScrollHandler(){let e=!1;const t=()=>{const t=window.scrollY;t>50?this.nav.classList.add("scrolled"):this.nav.classList.remove("scrolled"),this.nav.style.transform=t>this.lastScrollY&&t>100?"translateY(-100%)":"translateY(0)",this.lastScrollY=t,e=!1};window.addEventListener("scroll",()=>{e||(requestAnimationFrame(t),e=!0)})}setupMobileMenu(){this.mobileToggle&&this.mobileToggle.addEventListener("click",()=>this.toggleMobileMenu()),this.mobileMenu?.querySelectorAll("a").forEach(e=>{e.addEventListener("click",()=>this.closeMobileMenu())}),document.addEventListener("click",e=>{this.isMenuOpen&&!this.nav.contains(e.target)&&this.closeMobileMenu()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.isMenuOpen&&this.closeMobileMenu()})}toggleMobileMenu(){this.isMenuOpen?this.closeMobileMenu():this.openMobileMenu()}openMobileMenu(){console.log("Abriendo menú móvil"),console.log("Elemento mobileMenu:",this.mobileMenu),console.log("Clases antes:",this.mobileMenu.className),this.isMenuOpen=!0,this.prevFocus=document.activeElement,this.mobileToggle.classList.add("active"),this.mobileMenu.classList.add("active"),console.log("Clases después:",this.mobileMenu.className),console.log("Tiene clase active:",this.mobileMenu.classList.contains("active")),this.mobileToggle.setAttribute("aria-expanded","true"),this.mobileToggle.setAttribute("aria-label",this.lblClose),document.body.style.overflow="hidden",this.activateFocusTrap(this.mobileMenu)}closeMobileMenu(){this.isMenuOpen=!1,this.mobileToggle.classList.remove("active"),this.mobileMenu.classList.remove("active"),this.mobileToggle.setAttribute("aria-expanded","false"),this.mobileToggle.setAttribute("aria-label",this.lblOpen),document.body.style.overflow="",this.deactivateFocusTrap(),this.prevFocus&&this.prevFocus.focus&&this.prevFocus.focus()}activateFocusTrap(e){const t=()=>Array.from(e.querySelectorAll('a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])')).filter(e=>null!==e.offsetParent),s=t();s[0]&&s[0].focus(),this.focusTrapHandler=e=>{if("Tab"!==e.key)return;const s=t(),n=s[0],i=s[s.length-1];e.shiftKey&&document.activeElement===n?(e.preventDefault(),i.focus()):e.shiftKey||document.activeElement!==i||(e.preventDefault(),n.focus())},document.addEventListener("keydown",this.focusTrapHandler)}deactivateFocusTrap(){this.focusTrapHandler&&document.removeEventListener("keydown",this.focusTrapHandler),this.focusTrapHandler=null}setupActiveLinks(){const e=e=>"/"!==e&&e.endsWith("/")?e.slice(0,-1):e,t=e(window.location.pathname);this.nav.querySelectorAll(".nav-link, .mobile-link").forEach(s=>{const n=e(s.getAttribute("href")||"");(n===t||"/"!==n&&t.startsWith(n+"/"))&&s.classList.add("active")})}setupLanguageSwitcher(){if(!this.langToggle||!this.langDropdown)return;let e=!1;const t=()=>{this.langDropdown.classList.add("active"),this.langToggle.setAttribute("aria-expanded","true"),e=!0},s=()=>{this.langDropdown.classList.remove("active"),this.langToggle.setAttribute("aria-expanded","false"),e=!1};this.langToggle.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),e?s():t()}),document.addEventListener("click",t=>{!e||this.langToggle.contains(t.target)||this.langDropdown.contains(t.target)||s()}),document.addEventListener("keydown",t=>{"Escape"===t.key&&e&&(s(),this.langToggle.focus())})}setupKeyboardNavigation(){this.langToggle?.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.langToggle.click())})}}function t(){const e=document.getElementById("mobile-toggle"),t=document.getElementById("mobile-menu");if(e){e.classList.remove("active"),e.setAttribute("aria-expanded","false");const t=document.getElementById("main-nav")?.dataset.lang||"es";e.setAttribute("aria-label","es"===t?"Abrir menú":"Open menu")}t&&(t.classList.remove("active"),t.setAttribute("aria-hidden","true")),document.body.style.overflow=""}t(),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{t(),new e}):(t(),new e),document.addEventListener("astro:before-preparation",t),window.addEventListener("pageshow",t);
