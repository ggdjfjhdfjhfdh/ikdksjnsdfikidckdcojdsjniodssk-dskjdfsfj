const e=new class{constructor(){this.intersectionObserver=null,this.lazyElements=new Set,this.loadedModules=new Map,this.init()}init(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.setup()):this.setup()}setup(){this.setupIntersectionObserver(),this.setupLazyLoading(),this.setupCodeSplitting(),this.optimizeImages(),this.preloadCriticalResources()}setupIntersectionObserver(){"IntersectionObserver"in window&&(this.intersectionObserver=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(this.loadElement(e.target),this.intersectionObserver.unobserve(e.target))})},{rootMargin:"50px 0px",threshold:.1}))}setupLazyLoading(){document.querySelectorAll('img[loading="lazy"]').forEach(e=>{this.intersectionObserver&&this.intersectionObserver.observe(e)});document.querySelectorAll("[data-lazy]").forEach(e=>{this.intersectionObserver&&this.intersectionObserver.observe(e)})}setupCodeSplitting(){document.querySelectorAll("[data-component]").forEach(e=>{this.intersectionObserver&&this.intersectionObserver.observe(e)})}async loadElement(e){try{"IMG"===e.tagName&&e.dataset.src&&await this.loadImage(e),e.dataset.component&&await this.loadComponent(e),e.dataset.lazy&&await this.loadSection(e),e.classList.add("loaded")}catch(t){console.warn("Error loading element:",t)}}loadImage(e){return new Promise((t,n)=>{const o=new Image;o.onload=()=>{e.src=e.dataset.src,e.classList.add("loaded"),t()},o.onerror=n,o.src=e.dataset.src})}async loadComponent(e){const t=e.dataset.component;if(this.loadedModules.has(t))return this.loadedModules.get(t);try{const n=await((e,t,n)=>{const o=e[t];return o?"function"==typeof o?o():Promise.resolve(o):new Promise((e,o)=>{("function"==typeof queueMicrotask?queueMicrotask:setTimeout)(o.bind(null,new Error("Unknown variable dynamic import: "+t+(t.split("/").length!==n?". Note that variables only represent file names one level deep.":""))))})})(Object.assign({}),`../components/${t}.js`,3);return this.loadedModules.set(t,n),n.default&&"function"==typeof n.default&&n.default(e),n}catch(n){console.warn(`Failed to load component: ${t}`,n)}}loadSection(e){return new Promise(t=>{e.style.opacity="0",e.style.transform="translateY(20px)",requestAnimationFrame(()=>{e.style.transition="opacity 0.6s ease, transform 0.6s ease",e.style.opacity="1",e.style.transform="translateY(0)",setTimeout(t,600)})})}optimizeImages(){document.querySelectorAll('img:not([loading="lazy"])').forEach(e=>{e.hasAttribute("loading")||e.setAttribute("loading","lazy"),e.hasAttribute("decoding")||e.setAttribute("decoding","async")})}preloadCriticalResources(){document.querySelectorAll('img[data-priority="high"]').forEach(e=>{const t=document.createElement("link");t.rel="preload",t.as="image",t.href=e.src||e.dataset.src,document.head.appendChild(t)})}measurePerformance(){"performance"in window&&window.addEventListener("load",()=>{setTimeout(()=>{const e=performance.getEntriesByType("navigation")[0],t=performance.getEntriesByType("paint"),n={loadTime:Math.round(e.loadEventEnd-e.loadEventStart),domContentLoaded:Math.round(e.domContentLoadedEventEnd-e.domContentLoadedEventStart),firstPaint:Math.round(t.find(e=>"first-paint"===e.name)?.startTime||0),firstContentfulPaint:Math.round(t.find(e=>"first-contentful-paint"===e.name)?.startTime||0),totalPageSize:this.calculatePageSize(),resourceCount:performance.getEntriesByType("resource").length};console.log("ðŸš€ Performance Metrics:",n),this.storeMetrics(n),this.displayPerformanceIndicator(n)},100)})}calculatePageSize(){return performance.getEntriesByType("resource").reduce((e,t)=>e+(t.transferSize||0),0)}storeMetrics(e){try{localStorage.setItem("sesec_performance_metrics",JSON.stringify({...e,timestamp:Date.now(),url:window.location.pathname}))}catch(t){console.warn("Could not store performance metrics:",t)}}displayPerformanceIndicator(e){const t=document.createElement("div");t.id="performance-indicator",t.style.cssText="\n      position: fixed;\n      top: 10px;\n      right: 10px;\n      background: rgba(0, 0, 0, 0.8);\n      color: white;\n      padding: 8px 12px;\n      border-radius: 6px;\n      font-size: 12px;\n      z-index: 9999;\n      font-family: monospace;\n      opacity: 0.7;\n      transition: opacity 0.3s ease;\n    ";const n=this.calculatePerformanceScore(e),o=n>=90?"#10b981":n>=70?"#f59e0b":"#ef4444";t.innerHTML=`\n      <div style="color: ${o};">âš¡ ${n}/100</div>\n      <div style="font-size: 10px; opacity: 0.8;">\n        FCP: ${e.firstContentfulPaint}ms<br>\n        Size: ${Math.round(e.totalPageSize/1024)}KB\n      </div>\n    `,document.body.appendChild(t),setTimeout(()=>{t.style.opacity="0",setTimeout(()=>t.remove(),300)},5e3)}calculatePerformanceScore(e){let t=100;return e.firstContentfulPaint>2500?t-=30:e.firstContentfulPaint>1800&&(t-=15),e.totalPageSize>3e6?t-=20:e.totalPageSize>15e5&&(t-=10),e.resourceCount>50?t-=15:e.resourceCount>30&&(t-=8),Math.max(0,Math.min(100,t))}destroy(){this.intersectionObserver&&this.intersectionObserver.disconnect(),this.lazyElements.clear(),this.loadedModules.clear()}};window.PerformanceOptimizer=e;export{e as default};
