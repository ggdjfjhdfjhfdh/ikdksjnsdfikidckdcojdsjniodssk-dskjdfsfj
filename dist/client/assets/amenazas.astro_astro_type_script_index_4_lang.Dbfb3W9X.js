class t{updateInterval;isUpdating;lastUpdate;updateTimer;retryCount;maxRetries;constructor(){this.updateInterval=3e4,this.isUpdating=!1,this.lastUpdate=new Date,this.updateTimer=null,this.retryCount=0,this.maxRetries=3,this.lastDataCache=null,this.init()}init(){this.updateLastUpdateDisplay(),this.showStaticDataFirst(),this.loadFromCacheFirst(),this.updateThreatData(),setTimeout(()=>{this.startAutoUpdate()},this.updateInterval),document.addEventListener("visibilitychange",()=>{document.hidden?this.pauseUpdates():this.resumeUpdates()}),this.addManualUpdateButton()}loadFromCacheFirst(){try{const t=localStorage.getItem("threatData"),a=localStorage.getItem("threatDataTime");if(t&&a){if(Date.now()-parseInt(a)<12e4){const a=JSON.parse(t);this.updateUIWithData(a,!0),console.log("🚀 Datos cargados desde cache para mejor rendimiento")}}}catch(t){console.warn("Error cargando cache:",t)}}saveToCache(t){try{localStorage.setItem("threatData",JSON.stringify(t)),localStorage.setItem("threatDataTime",Date.now().toString())}catch(a){console.warn("Error guardando en cache:",a)}}showStaticDataFirst(){const t={cloudflare:{topCountries:[{name:"Estados Unidos",attacks:3200,flag:"🇺🇸"},{name:"China",attacks:2400,flag:"🇨🇳"},{name:"Rusia",attacks:1800,flag:"🇷🇺"}]},ransomwatch:{count:165,rawData:{recentPosts:[{group_name:"LockBit",post_title:"Manufacturing Company",timestamp:Date.now()-36e5},{group_name:"BlackCat",post_title:"Healthcare Provider",timestamp:Date.now()-72e5}]}},urlhaus:{count:1100},malwarebazaar:{count:1400}};this.updateUIWithData(t,!0),console.log("📊 Datos estáticos mostrados para mejor UX")}async updateUIWithData(t,a=!1){window.threatMapProps||(window.threatMapProps={}),window.timelineData||(window.timelineData={events:[]});const e=window.threatMapProps.threatData;window.threatMapProps.threatData={...t,recentEvents:window.timelineData.events||[]},a||this.showLoadingProgress("Actualizando interfaz...");const i=[];!a&&e&&JSON.stringify(e.cloudflare?.topCountries)===JSON.stringify(t.cloudflare?.topCountries)||i.push(Promise.resolve(this.updateCountriesPanel(t))),!a&&e&&JSON.stringify(e.categories)===JSON.stringify(t.categories)||i.push(Promise.resolve(this.updateAttackCategories(t))),!a&&e&&JSON.stringify(e.recentAttacks)===JSON.stringify(t.recentAttacks)||i.push(Promise.resolve(this.updateRecentAttacks(t))),await Promise.all(i),window.webglThreatMap&&window.webglThreatMap.updateData&&window.webglThreatMap.updateData(t)}async updateThreatData(){if(!this.isUpdating){this.isUpdating=!0,this.showUpdateIndicator(!0);try{this.showLoadingProgress("Conectando con servidor...");const t="https://sesec-backend.fly.dev",a=new AbortController,e=setTimeout(()=>a.abort(),15e3),i=await fetch(`${t}/api/threat/data`,{method:"GET",headers:{Accept:"application/json","Cache-Control":"max-age=30"},signal:a.signal});if(clearTimeout(e),this.showLoadingProgress("Procesando datos..."),!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);const n=await i.json();if(!(n&&n.success&&this.validateData(n.data)))throw new Error("Datos inválidos recibidos");{const t=n.data;window.threatMapProps||(window.threatMapProps={}),window.timelineData||(window.timelineData={events:[]}),await this.updateUIWithData(t,!1),this.saveToCache(t),this.lastUpdate=new Date,this.retryCount=0}}catch(t){if(console.error("Error actualizando datos:",t),t.message.includes("429")){console.log("🔄 Error 429 detectado, intentando usar datos en caché...");try{const t=localStorage.getItem("threatData");if(t){const a=JSON.parse(t);return console.log("✅ Usando datos en caché como fallback"),void(await this.updateUIWithData(a,!0))}}catch(a){console.warn("Error accediendo al caché:",a)}}this.retryCount++,this.retryCount<this.maxRetries?setTimeout(()=>this.updateThreatData(),12e4):this.showUpdateError(t.message)}finally{this.isUpdating=!1,this.showUpdateIndicator(!1),this.updateLastUpdateDisplay()}}}validateData(t){if(!t||"object"!=typeof t)return console.log("❌ Validación falló: datos no válidos o no es objeto"),!1;const a=[t.urlhaus&&!t.urlhaus.error,t.cloudflare&&!t.cloudflare.error,t.ransomwatch&&!t.ransomwatch.error,t.sansISC&&!t.sansISC.error].filter(Boolean),e=a.length>0;return e?console.log("✅ Validación exitosa:",a.length,"fuentes válidas"):(console.log("❌ Validación falló: no hay fuentes de datos válidas disponibles"),console.log("Errores encontrados:",{urlhaus:t.urlhaus?.error,cloudflare:t.cloudflare?.error,ransomwatch:t.ransomwatch?.error,sansISC:t.sansISC?.error})),e}updateCountriesPanel(t){const a=document.querySelector(".countries-stats");if(!a||!t.cloudflare?.topCountries)return;this.countryFlagsCache||(this.countryFlagsCache={"United States":"🇺🇸",USA:"🇺🇸",US:"🇺🇸",China:"🇨🇳",CN:"🇨🇳",Russia:"🇷🇺",RU:"🇷🇺",Germany:"🇩🇪",DE:"🇩🇪","United Kingdom":"🇬🇧",UK:"🇬🇧",GB:"🇬🇧",France:"🇫🇷",FR:"🇫🇷",Japan:"🇯🇵",JP:"🇯🇵",Brazil:"🇧🇷",BR:"🇧🇷",India:"🇮🇳",IN:"🇮🇳",Canada:"🇨🇦",CA:"🇨🇦"});const e=document.createDocumentFragment(),i=t.cloudflare.topCountries.slice(0,5);for(let n=0;n<i.length;n++){const t=i[n],a=t.name||t.country||t.code||t.alpha2||"Desconocido",o=this.countryFlagsCache[a]||this.countryFlagsCache[t.code]||this.countryFlagsCache[t.alpha2]||"🌍",s=(t.attacks||t.count||1500).toLocaleString(),r=document.createElement("div");r.className="country-item",r.innerHTML=`\n              <div class="country-info">\n                <span class="country-flag">${o}</span>\n                <span class="country-name">${a}</span>\n                <span class="country-attacks">${s}</span>\n              </div>\n            `,e.appendChild(r)}a.innerHTML="",a.appendChild(e)}updateAttackCategories(t){document.querySelectorAll(".category-item").forEach((a,e)=>{const i=a.querySelector(".category-count");if(!i)return;let n=0;switch(e){case 0:n=t.urlhaus?.count||t.urlhaus?.total_urls||0;break;case 1:n=Math.floor(1e5*(t.cloudflare?.percentage||0));break;case 2:n=t.ransomwatch?.count7d||t.ransomwatch?.count||0;break;case 3:n=Math.floor(1500*(t.cloudflare?.topAttackPairs?.length||0));break;case 4:n=Math.floor(800*(t.cloudflare?.topCountries?.length||0))}i.textContent=n.toLocaleString()})}getTimeDifference(t){const a=(new Date).getTime()-new Date(t).getTime(),e=Math.floor(a/6e4),i=Math.floor(a/36e5),n=Math.floor(a/864e5);return n>0?`Hace ${n} día${n>1?"s":""}`:i>0?`Hace ${i} hora${i>1?"s":""}`:e>0?`Hace ${e} min`:"Ahora mismo"}updateRecentAttacks(t){console.log("🔄 Actualizando ataques recientes...",t);const a=document.querySelector(".recent-attacks-list");a?requestAnimationFrame(()=>{const e=this.parseAttackData(t),i=this.generateAttackHTML(e);this.updateAttacksContainer(a,i,e)}):console.error("❌ No se encontró el contenedor .recent-attacks-list")}updateAttacksContainer(t,a,e){const i=t.querySelector(".loading-placeholder");i?(i.style.opacity="0",i.style.transform="translateY(-10px)",setTimeout(()=>{t.innerHTML=a;t.querySelectorAll(".attack-item").forEach((t,a)=>{const e=t;e.style.opacity="0",e.style.transform="translateY(20px)",setTimeout(()=>{e.style.transition="all 0.4s ease",e.style.opacity="1",e.style.transform="translateY(0)"},100*a)}),this.addAttackModalListeners(e)},300)):(t.innerHTML=a,this.addAttackModalListeners(e)),console.log(`✅ ${e.length} ataques actualizados`)}parseAttackData(t){const a=JSON.stringify({ransomCount:t.ransomwatch?.count||0,cloudflareCount:t.cloudflare?.topCountries?.length||0,urlhausCount:t.urlhaus?.count||0});if(this.lastDataCache&&this.lastDataCache.key===a)return this.lastDataCache.attacks;const e=[],i=new Date;[()=>this.addRansomwareAttacks(t,e,i),()=>this.addDDoSAttacks(t,e,i),()=>this.addMalwareAttacks(t,e,i),()=>this.addBotnetAttacks(t,e,i)].forEach(t=>t());const n=e.sort((t,a)=>(a.timestamp||0)-(t.timestamp||0)).slice(0,10);return this.lastDataCache={key:a,attacks:n},n}addRansomwareAttacks(t,a,e){const i=t.ransomwatch?.rawData?.recentPosts||t.ransomwatch?.rawData?.weeklyPosts?.slice(0,5)||[];i.length>0&&i.slice(0,3).forEach((t,i)=>{const n=new Date(t.discovered||e.getTime()-36e5*(i+3)),o=t.post_title||t.victim||"Organización no especificada",s=t.group_name||t.group||"grupo desconocido",r=t.industry||this.extractIndustry(o),c=t.country||this.extractCountry(o);a.push({type:"Ransomware",description:`Ataque de ${s} contra ${o}`,location:this.extractLocation(o),time:this.getTimeDifference(n),severity:this.getRansomwareSeverity(s),timestamp:n,source:"RansomWatch",details:{victim:o,group:s,industry:r,country:c,discovered:t.discovered,published:t.published,post_url:t.post_url,ransomware_family:t.malware_family||s}})})}addDDoSAttacks(t,a,e){const i=t.cloudflare?.topAttackPairs?.slice(0,3)||[],n=t.cloudflare?.topCountries?.slice(0,2)||[];i.forEach((t,i)=>{const n=new Date(e.getTime()-36e5*(i+1)),o=t.origin_country||"Origen desconocido",s=t.target_country||"Destino desconocido",r=this.getCountryFlag(o),c=this.getCountryFlag(s),l=t.type||"DDoS",d=t.attacks||t.requests||0;a.push({type:l.toUpperCase(),description:`Ataque ${l} de ${r} ${o} a ${c} ${s}`,location:`${r} → ${c}`,time:this.getTimeDifference(n),severity:this.getDDoSSeverity(d),timestamp:n,source:"Cloudflare Radar",details:{origin_country:o,target_country:s,attack_type:l,volume:d,duration:t.duration,peak_bps:t.peak_bps,peak_pps:t.peak_pps}})}),n.forEach((t,i)=>{const n=new Date(e.getTime()-36e5*(i+4)),o=t.name||t.country||"País desconocido",s=this.getCountryFlag(o),r=t.attacks||t.count||0;a.push({type:"DDoS",description:`${r.toLocaleString()} ataques DDoS desde ${o}`,location:`${s} ${o}`,time:this.getTimeDifference(n),severity:this.getDDoSSeverity(r),timestamp:n,source:"Cloudflare Radar",details:{country:o,attack_count:r,percentage:t.percentage,rank:t.rank}})})}addMalwareAttacks(t,a,e){const i=t.urlhaus;if(i?.count>0){const t=new Date(e.getTime()-9e5),n=i.recent_samples?.slice(0,3)||[],o=i.topCountries?.slice(0,3)||[],s=i.malwareFamilies?.slice(0,2)||[];a.push({type:"Malware",description:`${i.count.toLocaleString()} URLs maliciosas detectadas`,location:"🌐 Global",time:this.getTimeDifference(t),severity:this.getMalwareSeverity(i.count),timestamp:t,source:"URLhaus",details:{total_urls:i.count,recent_samples:n,top_countries:o,malware_families:s,threat_types:i.threatTypes,online_ratio:i.analytics?.onlineRatio,average_hourly:i.analytics?.averageHourly}}),n.forEach((t,i)=>{const n=new Date(t.date_added||e.getTime()-6e4*(i+5)),o=t.threat||t.tags?.[0]||"Malware",s=t.country||"Desconocido",r=this.getCountryFlag(s);a.push({type:o,description:`URL maliciosa: ${t.url?.substring(0,50)}...`,location:`${r} ${s}`,time:this.getTimeDifference(n),severity:this.getURLSeverity(t),timestamp:n,source:"URLhaus",details:{url:t.url,threat_type:o,country:s,date_added:t.date_added,status:t.url_status,tags:t.tags}})})}}addBotnetAttacks(t,a,e){if(t.feodotracker?.count>0){const i=new Date(e.getTime()-27e5);a.push({type:"Botnet",description:`${t.feodotracker.count} servidores C&C activos`,location:"🌐 Global",time:this.getTimeDifference(i),severity:"medium",timestamp:i,source:"FeodoTracker"})}}extractLocation(t){const a=[/\b(USA?|United States)\b/i,/\b(UK|United Kingdom|Britain)\b/i,/\b(Germany|Deutschland)\b/i,/\b(France|Francia)\b/i,/\b(Japan|Japón)\b/i,/\b(China)\b/i];for(const e of a)if(e.test(t)){const a=t.match(e);if(a)return this.getCountryFlag(a[0])+" "+a[0]}return"🌍 Ubicación no especificada"}getCountryFlag(t){return{"United States":"🇺🇸",USA:"🇺🇸",US:"🇺🇸","United Kingdom":"🇬🇧",UK:"🇬🇧",Britain:"🇬🇧",Germany:"🇩🇪",Deutschland:"🇩🇪",France:"🇫🇷",Francia:"🇫🇷",Japan:"🇯🇵","Japón":"🇯🇵",China:"🇨🇳",Russia:"🇷🇺",Canada:"🇨🇦",Australia:"🇦🇺",Brazil:"🇧🇷",India:"🇮🇳"}[t]||"🌍"}getRansomwareSeverity(t){return{lockbit:"critical",blackcat:"high",conti:"high",revil:"high",hive:"medium",ransomhouse:"medium",bianlian:"medium",royal:"medium"}[t.toLowerCase()]||"medium"}getDDoSSeverity(t){return t>1e6?"critical":t>1e5?"high":t>1e4?"medium":"low"}getMalwareSeverity(t){return t>5e3?"critical":t>1e3?"high":t>500?"medium":"low"}getURLSeverity(t){const a=t.threat||t.tags||[];return a.includes("malware_download")||a.includes("ransomware")?"high":a.includes("phishing")||a.includes("scam")?"medium":"low"}extractIndustry(t){const a=[{pattern:/\b(hospital|clinic|medical|healthcare|health care|médico|hospitalario)\b/i,industry:"Salud"},{pattern:/\b(bank|financial|finance|bancario|financiero|credit|loan|insurance|seguros)\b/i,industry:"Financiero"},{pattern:/\b(government|gov|municipal|public sector|gobierno|municipalidad)\b/i,industry:"Gobierno"},{pattern:/\b(education|school|university|college|educación|universidad|colegio)\b/i,industry:"Educación"},{pattern:/\b(energy|oil|gas|petroleum|energía|petróleo|gasolina)\b/i,industry:"Energía"},{pattern:/\b(transport|logistics|shipping|transporte|logística|envío)\b/i,industry:"Transporte"},{pattern:/\b(retail|store|shop|ecommerce|e-commerce|comercio|tienda)\b/i,industry:"Retail"},{pattern:/\b(technology|tech|software|hardware|IT|tecnología|informática)\b/i,industry:"Tecnología"},{pattern:/\b(manufacturing|factory|production|manufactura|fábrica|producción)\b/i,industry:"Manufactura"},{pattern:/\b(telecom|telecommunications|communications|telecomunicaciones)\b/i,industry:"Telecomunicaciones"}];for(const{pattern:e,industry:i}of a)if(e.test(t))return i;return"Industria no especificada"}extractCountry(t){const a=[{pattern:/\b(USA|United States|US|EE\.UU\.)\b/i,country:"Estados Unidos"},{pattern:/\b(UK|United Kingdom|Britain|England)\b/i,country:"Reino Unido"},{pattern:/\b(Germany|Deutschland)\b/i,country:"Alemania"},{pattern:/\b(France|Francia)\b/i,country:"Francia"},{pattern:/\b(Spain|España)\b/i,country:"España"},{pattern:/\b(Italy|Italia)\b/i,country:"Italia"},{pattern:/\b(Canada|Canadá)\b/i,country:"Canadá"},{pattern:/\b(Australia)\b/i,country:"Australia"},{pattern:/\b(Japan|Japón)\b/i,country:"Japón"},{pattern:/\b(China)\b/i,country:"China"},{pattern:/\b(Russia|Rusia)\b/i,country:"Rusia"},{pattern:/\b(Brazil|Brasil)\b/i,country:"Brasil"},{pattern:/\b(Mexico|México)\b/i,country:"México"}];for(const{pattern:e,country:i}of a)if(e.test(t))return i;return"País no especificado"}getAttackIcon(t){return{DDoS:"⚡",Ransomware:"🔒",Malware:"🦠",Phishing:"🎣",Botnet:"🕸️","Data Breach":"💾","SQL Injection":"💉",XSS:"🔗","Brute Force":"🔨","Zero Day":"🎯"}[t]||"⚠️"}generateAttackHTML(t){const a={critical:"Crítica",high:"Alta",medium:"Media",low:"Baja"},e=[];for(let i=0;i<t.length;i++){const n=t[i],o=this.getAttackIcon(n.type),s=a[n.severity]||"Media",r=`progress-fill-${n.severity}`;e.push(`<div class="attack-card ${n.severity}" style="animation-delay: ${.1*i}s">`,"\x3c!-- Header con icono, timeline y severidad --\x3e",'<div class="attack-header">',`  <span class="attack-icon">${o}</span>`,'  <div class="attack-timeline">',`    <span class="time-ago">${n.time}</span>`,'    <div class="progress-bar">',`      <div class="progress-fill ${n.severity} ${r}"></div>`,"    </div>","  </div>",`  <span class="severity-badge ${n.severity}">${s}</span>`,"</div>","\x3c!-- Contenido principal --\x3e",'<div class="attack-content">',`  <h4 class="attack-title">${n.type}</h4>`,`  <p class="attack-description">${n.description}</p>`,"  \x3c!-- Métricas de estado e impacto --\x3e",'  <div class="attack-metrics">','    <div class="metric">','      <span class="metric-label">Estado</span>','      <span class="metric-value">Activo</span>',"    </div>",'    <div class="metric">','      <span class="metric-label">Impacto</span>',`      <span class="metric-value">${impactText}</span>`,"    </div>","  </div>","  \x3c!-- Ubicación y acciones --\x3e",'  <div class="attack-location-actions">','    <div class="attack-location">','      <span class="location-icon">📍</span>',`      <span class="location-text">${n.location}</span>`,"    </div>",'    <div class="attack-actions">',this.shouldShowAnalyzeButton(n)?'      <button class="btn-analyze" onclick="event.stopPropagation();">🔍 Analizar</button>':"","    </div>","  </div>","</div>","\x3c!-- Footer con badge de verificación --\x3e",'<div class="attack-footer">','  <span class="verified-badge">✅ Monitorizado</span>',"</div>","</div>")}return e.join("")}shouldShowAnalyzeButton(t){return null!==this.extractCoordinatesFromLocation(t.location)}addAttackModalListeners(t){document.querySelectorAll(".attack-card").forEach((a,e)=>{const i=t[e];a.addEventListener("click",()=>{this.showAttackModal(i)});const n=a.querySelector(".btn-analyze");n&&n.addEventListener("click",t=>{t.stopPropagation(),this.analyzeAttack(i)})})}analyzeAttack(t){console.log("Analizando ataque:",t),this.highlightAttackOnMap(t),this.showAnalysisNotification(t),this.scrollToMap()}highlightAttackOnMap(t){console.log("Destacando ataque en el mapa:",t);try{if(void 0===window.threatMap||!window.threatMap.highlightAttack)return console.error("Mapa WebGL no disponible para integración"),this.showAnalysisNotification(t),!1;const a=this.extractCoordinatesFromLocation(t.location);if(a){t.coordinates=a;if(window.threatMap.highlightAttack(t))return console.log("Ataque destacado exitosamente en el mapa"),this.showAnalysisNotification(t),!0}if(console.log("Intentando destacar por tipo:",t.type,t.severity),window.threatMap.highlightAttackByType){if(window.threatMap.highlightAttackByType(t.type,t.severity))return console.log("Ataques por tipo destacados exitosamente"),this.showAnalysisNotification(t),!0}return console.error("Error al destacar ataque en el mapa"),this.showAnalysisNotification(t),!1}catch(a){return console.error("Error en highlightAttackOnMap:",a),this.showAnalysisNotification(t),!1}}extractCoordinatesFromLocation(t){const a={"japón":[139.6917,35.6895],japan:[139.6917,35.6895],eeuu:[-74.006,40.7128],usa:[-74.006,40.7128],"estados unidos":[-74.006,40.7128],"united states":[-74.006,40.7128],"españa":[-3.7038,40.4168],spain:[-3.7038,40.4168],alemania:[13.405,52.52],germany:[13.405,52.52],francia:[2.3522,48.8566],france:[2.3522,48.8566],"reino unido":[-.1278,51.5074],uk:[-.1278,51.5074],"united kingdom":[-.1278,51.5074],china:[116.4074,39.9042],brasil:[-47.9292,-15.7801],brazil:[-47.9292,-15.7801],rusia:[37.6173,55.7558],russia:[37.6173,55.7558],"canadá":[-75.6972,45.4215],canada:[-75.6972,45.4215],"méxico":[-99.1332,19.4326],mexico:[-99.1332,19.4326],italia:[12.4964,41.9028],italy:[12.4964,41.9028],australia:[149.1289,-35.2809],india:[77.209,28.6139],"corea del sur":[126.978,37.5665],"south korea":[126.978,37.5665],global:[0,0],"🌐":[0,0],europa:[15.2551,54.526],europe:[15.2551,54.526],"américa":[-85,10],america:[-85,10],asia:[100,35],"áfrica":[20,0],africa:[20,0],oceania:[133.7751,-25.2744]},e=t.replace(/[^\w\sáéíóúñüÁÉÍÓÚÑÜ]/gi,"").trim().toLowerCase();console.log("Ubicación limpia:",e,"original:",t);for(const[i,n]of Object.entries(a))if(e===i.toLowerCase())return n;for(const[i,n]of Object.entries(a))if(e.includes(i.toLowerCase()))return n;return e.includes("global")||t.includes("🌐")||t.includes("🌍")||t.includes("🌎")||t.includes("🌏")?(console.log("Ubicación global detectada, usando estrategia de fallback"),null):(console.log("No se encontraron coordenadas para:",t,"limpia:",e),null)}showAnalysisNotification(t){const a=document.createElement("div");a.className="analysis-notification",a.innerHTML=`\n            <div class="notification-content">\n              <span class="notification-icon">🔍</span>\n              <div class="notification-text">\n                <strong>Analizando: ${t.type}</strong>\n                <span>${t.description}</span>\n              </div>\n              <button class="notification-close">×</button>\n            </div>\n          `,document.body.appendChild(a),setTimeout(()=>{a.classList.add("show")},10),setTimeout(()=>{a.parentNode&&(a.classList.remove("show"),setTimeout(()=>{a.remove()},300))},5e3);const e=a.querySelector(".notification-close");e?.addEventListener("click",()=>{a.classList.remove("show"),setTimeout(()=>{a.remove()},300)})}scrollToMap(){const t=document.querySelector(".webgl-map-container");t&&t.scrollIntoView({behavior:"smooth",block:"center"})}showAttackModal(t){let a=document.querySelector(".attack-modal");a||(a=this.createAttackModal(),document.body.appendChild(a)),this.updateModalContent(a,t),a.style.display="flex",setTimeout(()=>{a?.classList.add("show")},10)}createAttackModal(){const t=document.createElement("div");t.className="attack-modal",t.innerHTML='\n            <div class="modal-overlay"></div>\n            <div class="modal-content">\n              <div class="modal-header">\n                <h3 class="modal-title">Detalles del Ataque</h3>\n                <button class="modal-close">×</button>\n              </div>\n              <div class="modal-body">\n                <div class="attack-details-grid">\n                  <div class="detail-section">\n                    <h4>Información General</h4>\n                    <div class="detail-item">\n                      <span class="detail-label">Tipo:</span>\n                      <span class="detail-value attack-type-value"></span>\n                    </div>\n                    <div class="detail-item">\n                      <span class="detail-label">Severidad:</span>\n                      <span class="detail-value attack-severity-value"></span>\n                    </div>\n                    <div class="detail-item">\n                      <span class="detail-label">Tiempo:</span>\n                      <span class="detail-value attack-time-value"></span>\n                    </div>\n                  </div>\n                  <div class="detail-section">\n                    <h4>Ubicación y Fuente</h4>\n                    <div class="detail-item">\n                      <span class="detail-label">Ubicación:</span>\n                      <span class="detail-value attack-location-value"></span>\n                    </div>\n                    <div class="detail-item">\n                      <span class="detail-label">Fuente:</span>\n                      <span class="detail-value attack-source-value"></span>\n                    </div>\n                  </div>\n                  <div class="detail-section full-width">\n                    <h4>Descripción</h4>\n                    <p class="attack-description-value"></p>\n                  </div>\n                  <div class="detail-section full-width">\n                    <h4>Recomendaciones de Mitigación</h4>\n                    <div class="mitigation-recommendations"></div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          ';const a=t.querySelector(".modal-close"),e=t.querySelector(".modal-overlay"),i=()=>{t.classList.remove("show"),setTimeout(()=>{t.style.display="none"},300)};return a?.addEventListener("click",i),e?.addEventListener("click",i),t}updateModalContent(t,a){const e=t.querySelector(".attack-type-value"),i=t.querySelector(".attack-severity-value"),n=t.querySelector(".attack-time-value"),o=t.querySelector(".attack-location-value"),s=t.querySelector(".attack-source-value"),r=t.querySelector(".attack-description-value"),c=t.querySelector(".mitigation-recommendations");e&&(e.textContent=a.type),i&&(i.textContent="critical"===a.severity?"Crítica":"high"===a.severity?"Alta":"Media",i.className=`detail-value attack-severity-value ${a.severity}`),n&&(n.textContent=a.time),o&&(o.textContent=a.location),s&&(s.textContent=a.source),r&&(r.textContent=a.description),c&&(c.innerHTML=this.generateMitigationRecommendations(a.type))}generateMitigationRecommendations(t){return({DDoS:["Implementar protección DDoS en el perímetro de red","Configurar rate limiting en servidores web","Utilizar CDN con protección anti-DDoS","Monitorear tráfico de red en tiempo real"],Ransomware:["Realizar copias de seguridad regulares y offline","Mantener sistemas actualizados con parches de seguridad","Implementar segmentación de red","Capacitar usuarios sobre phishing y malware"],Malware:["Instalar y mantener antivirus actualizado","Implementar whitelist de aplicaciones","Configurar firewall de aplicaciones","Realizar análisis regulares del sistema"],Botnet:["Monitorear comunicaciones de red sospechosas","Implementar detección de comportamiento anómalo","Bloquear dominios y IPs maliciosas conocidas","Actualizar sistemas y aplicaciones regularmente"]}[t]||["Mantener sistemas actualizados","Implementar monitoreo de seguridad","Capacitar personal en ciberseguridad","Realizar auditorías de seguridad regulares"]).map(t=>`<div class="recommendation-item">• ${t}</div>`).join("")}startAutoUpdate(){this.updateTimer=window.setInterval(()=>{this.updateThreatData()},this.updateInterval)}pauseUpdates(){this.updateTimer&&(clearInterval(this.updateTimer),this.updateTimer=null)}resumeUpdates(){this.updateTimer||this.startAutoUpdate()}addManualUpdateButton(){const t=document.querySelector(".threat-dashboard-header");if(!t)return;const a=document.createElement("button");a.className="manual-update-btn",a.innerHTML="🔄 Actualizar",a.onclick=()=>this.updateThreatData(),t.appendChild(a)}showUpdateIndicator(t){(document.querySelector(".update-indicator")||this.createUpdateIndicator()).style.display=t?"block":"none"}createUpdateIndicator(){const t=document.createElement("div");return t.className="update-indicator",t.innerHTML='\n            <div style="display: flex; align-items: center; gap: 8px;">\n              <div class="spinner" style="\n                width: 16px;\n                height: 16px;\n                border: 2px solid rgba(255, 255, 255, 0.3);\n                border-top: 2px solid white;\n                border-radius: 50%;\n                animation: spin 1s linear infinite;\n              "></div>\n              <span class="progress-text">Actualizando datos...</span>\n            </div>\n          ',t.style.cssText="\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            background: rgba(59, 130, 246, 0.9);\n            color: white;\n            padding: 12px 16px;\n            border-radius: 8px;\n            z-index: 1000;\n            display: none;\n            backdrop-filter: blur(10px);\n            border: 1px solid rgba(255, 255, 255, 0.1);\n            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n          ",document.body.appendChild(t),t}showLoadingProgress(t){const a=document.querySelector(".progress-text");a&&(a.textContent=t)}showUpdateSuccess(){this.showNotification("✅ Datos actualizados correctamente","success")}showUpdateError(t){this.showNotification(`❌ Error: ${t}`,"error")}showNotification(t,a){const e=document.createElement("div");e.className=`notification ${a}`,e.textContent=t,e.style.cssText=`\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            padding: 12px 16px;\n            border-radius: 8px;\n            z-index: 1001;\n            color: white;\n            background: ${"success"===a?"#10b981":"#ef4444"};\n          `,document.body.appendChild(e),setTimeout(()=>{e.remove()},3e3)}updateLastUpdateDisplay(){(document.querySelector(".last-update-time")||this.createLastUpdateDisplay()).textContent=`Última actualización: ${this.lastUpdate.toLocaleTimeString()}`}createLastUpdateDisplay(){const t=document.createElement("div");return t.className="last-update-time",t.style.cssText="\n            position: fixed;\n            bottom: 20px;\n            right: 20px;\n            background: rgba(0,0,0,0.7);\n            color: white;\n            padding: 8px 12px;\n            border-radius: 6px;\n            font-size: 12px;\n            z-index: 999;\n          ",document.body.appendChild(t),t}}document.addEventListener("DOMContentLoaded",()=>{window.threatDataUpdater=new t,window.testUpdateRecentAttacks=()=>{console.log("🧪 Probando actualización manual de ataques recientes..."),window.threatDataUpdater?window.threatDataUpdater.updateThreatData():console.error("❌ ThreatDataUpdater no está disponible")},console.log("🚀 Sistema de actualización inicializado"),console.log("💡 Usa window.testUpdateRecentAttacks() para probar manualmente")});
