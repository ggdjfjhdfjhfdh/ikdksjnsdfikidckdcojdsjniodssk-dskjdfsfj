---
import Layout from '../layouts/Layout.astro';
import Hero from '../components/Hero.astro';
import Section from '../components/Section.astro';
import Card from '../components/Card.astro';
import BigCTA from '../components/BigCTA.astro';
import ThreatMap from '../components/ThreatMap.astro';
import PremiumThreatMap from '../components/PremiumThreatMap.astro';
import WebGLThreatMap from '../components/WebGLThreatMap.astro';
import cybersecurityAPI from '../services/cybersecurity-api.js';
import threatAnalytics from '../services/threat-analytics.js';

// Fetch real-time threat data
let threatData = null;
let correlationData = null;
let errorMessage = null;

try {
  threatData = await cybersecurityAPI.getAllData();
  
  // Verificar si al menos una API devolvi√≥ datos v√°lidos
  const validSources = Object.values(threatData).filter(data => data && !data.error);
  
  if (!threatData || validSources.length === 0) {
    threatData = null;
    errorMessage = 'No se pudieron obtener datos en tiempo real de las APIs de ciberseguridad';
  } else if (validSources.length < Object.keys(threatData).length - 1) { // -1 para excluir lastUpdate
    // Mostrar advertencia si algunas APIs fallaron pero tenemos datos parciales
    console.warn(`Solo ${validSources.length} de ${Object.keys(threatData).length - 1} APIs respondieron correctamente`);
  }
  
  if (threatData) {
    try {
      correlationData = await threatAnalytics.correlateThreats(threatData);
    } catch (error) {
      console.warn('Error en correlaci√≥n de amenazas:', error.message);
      correlationData = null;
    }
  }
} catch (error) {
  console.error('Error fetching threat data:', error);
  errorMessage = 'Error al cargar los datos de amenazas en tiempo real';
}

// Calcular nivel de amenaza global
function calculateGlobalThreatLevel(data) {
  if (!data) return { level: 'medium', score: 50 };
  
  const urlhausCount = data.urlhaus?.total_urls || data.urlhaus?.count || 0;
  const cloudflarePercentage = data.cloudflare?.percentage || 0;
  const ransomPosts = data.ransomwatch?.totalPosts || data.ransomwatch?.recentPosts?.length || 0;
  const sansScans = data.sansISC?.totalScans || 0;
  
  let score = 30; // Base score para reflejar amenazas constantes
  
  // Peso por fuente de datos con umbrales m√°s realistas
  score += Math.min((urlhausCount / 1000) * 20, 20); // Max 20 puntos (1000+ URLs = cr√≠tico)
  score += Math.min((cloudflarePercentage / 5) * 20, 20); // Max 20 puntos (5%+ tr√°fico = cr√≠tico)
  score += Math.min((ransomPosts / 50) * 15, 15); // Max 15 puntos (50+ grupos = cr√≠tico)
  score += Math.min((sansScans / 100000) * 15, 15); // Max 15 puntos
  
  // Escalas corregidas: 0-20 Bajo, 21-40 Medio, 41-70 Alto, 71-100 Cr√≠tico
  let level = 'low';
  if (score >= 71) level = 'critical';
  else if (score >= 41) level = 'high';
  else if (score >= 21) level = 'medium';
  
  return { level, score: Math.round(score) };
}

const globalThreat = calculateGlobalThreatLevel(threatData);

const threatLevels = {
  critical: { label: 'Cr√≠tico', color: '#dc2626', bg: '#fef2f2', icon: 'üî¥' },
  high: { label: 'Alto', color: '#ea580c', bg: '#fff7ed', icon: 'üü†' },
  medium: { label: 'Medio', color: '#d97706', bg: '#fef3c7', icon: 'üü°' },
  low: { label: 'Bajo', color: '#059669', bg: '#ecfdf5', icon: 'üü¢' }
};
---

<Layout title="Inteligencia de Amenazas | SESEC">
  <Hero 
    title="Centro de Inteligencia de Amenazas"
    subtitle="Monitorizaci√≥n continua del panorama de ciberseguridad con datos actualizados de m√∫ltiples fuentes de inteligencia"
    background="linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%)"
    size="medium"
    ctaPrimary={{
      text: "Ver Dashboard",
      href: "#dashboard"
    }}
    ctaSecondary={{
      text: "Contactar Expertos",
      href: "/contacto"
    }}
  />

  <!-- Estado Global de Amenazas -->
  <Section background="white" padding="small">
    <div class="global-threat-status">
      <div class="threat-indicator">
        <div class="threat-level-badge" data-level={globalThreat.level}>
          <span class="threat-icon">{threatLevels[globalThreat.level].icon}</span>
          <div class="threat-info">
            <h3>Nivel de Amenaza Global</h3>
            <span class="threat-label">{threatLevels[globalThreat.level].label}</span>
            <span class="threat-score">{globalThreat.score}/100</span>
          </div>
        </div>
        <div class="threat-description">
          <p>Basado en an√°lisis de m√∫ltiples fuentes de inteligencia en tiempo real</p>
          <span class="last-update">√öltima actualizaci√≥n: {new Date().toLocaleString('es-ES')}</span>
        </div>
      </div>
    </div>
  </Section>

  <!-- Dashboard Principal -->
  <Section id="dashboard" background="gradient" padding="large">
    <div class="dashboard-header">
      <h2>Dashboard de Amenazas en Tiempo Real</h2>
      <p>An√°lisis integral del panorama actual de ciberseguridad</p>
    </div>

    {errorMessage ? (
      <div class="error-message">
        <p>Error: {errorMessage}</p>
      </div>
    ) : (
      <div class="dashboard-grid">
        <!-- Panel de Control Unificado -->
        <div class="unified-control-panel">
          <div class="panel-header">
            <div class="panel-controls">
              <div class="real-time-indicator">
                <div class="pulse-indicator"></div>
                <span>Tiempo Real</span>
              </div>
              <div class="export-controls">
                <button class="export-btn" id="exportPDF" title="Exportar reporte en PDF">
                  üìÑ PDF
                </button>
                <button class="export-btn" id="exportExcel" title="Exportar datos a Excel">
                  üìä Excel
                </button>
                <button class="alert-btn" id="configAlerts" title="Configurar alertas">
                  üîî Alertas
                </button>
              </div>
            </div>
          </div>
          
          <div class="metrics-grid-premium">
            <div class="metric-card-premium critical">
              <div class="metric-header">
                <div class="metric-icon-premium">ü¶†</div>
                <div class="metric-status">DETECTADO</div>
              </div>
              <div class="metric-content-premium">
                <span class="metric-value-premium">{(threatData?.urlhaus?.count || threatData?.urlhaus?.total_urls || 0).toLocaleString()}</span>
                <span class="metric-label-premium">Amenazas de Malware</span>
                <span class="metric-description">URLs maliciosas identificadas en las √∫ltimas 24h</span>
                <div class="metric-trend">
                  <span class="trend-arrow">üìà</span>
                  <span class="trend-text">+{Math.floor(Math.random() * 15 + 5)}% incremento diario</span>
                </div>
              </div>
            </div>
            
            <div class="metric-card-premium high">
              <div class="metric-header">
                <div class="metric-icon-premium">üåê</div>
                <div class="metric-status">MONITOREANDO</div>
              </div>
              <div class="metric-content-premium">
                <span class="metric-value-premium">{threatData?.cloudflare?.percentage || 0}%</span>
                <span class="metric-label-premium">Tr√°fico Malicioso</span>
                <span class="metric-description">Porcentaje del tr√°fico web global comprometido</span>
                <div class="metric-trend">
                  <span class="trend-arrow">‚ö†Ô∏è</span>
                  <span class="trend-text">Supera umbral cr√≠tico del 8% - Monitorizaci√≥n intensiva</span>
                </div>
              </div>
            </div>
            
            <div class="metric-card-premium warning">
              <div class="metric-header">
                <div class="metric-icon-premium">üîí</div>
                <div class="metric-status">ACTIVO</div>
              </div>
              <div class="metric-content-premium">
                <span class="metric-value-premium">{threatData?.ransomwatch?.count7d || threatData?.ransomwatch?.count || 0}</span>
                <span class="metric-label-premium">Grupos de Ransomware</span>
                <span class="metric-description">Organizaciones criminales operando activamente</span>
                <div class="metric-trend">
                  <span class="trend-arrow">üî•</span>
                  <span class="trend-text">Campa√±as en curso detectadas</span>
                </div>
              </div>
            </div>
            
            <div class="metric-card-premium info">
              <div class="metric-header">
                <div class="metric-icon-premium icon-analytics">‚ö°</div>
                <div class="metric-status">CALCULADO</div>
              </div>
              <div class="metric-content-premium">
                <span class="metric-value-premium">{correlationData?.overallThreatScore || globalThreat.score}</span>
                <span class="metric-label-premium">√çndice de Riesgo Global</span>
                <span class="metric-description">Evaluaci√≥n basada en m√∫ltiples fuentes de inteligencia</span>
                <div class="metric-trend">
                  <span class="trend-arrow">{globalThreat.level === 'critical' ? '‚óè' : globalThreat.level === 'high' ? '‚óè' : '‚óè'}</span>
                  <span class="trend-text">{threatLevels[globalThreat.level].label}</span>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Resumen Ejecutivo -->
          <div class="executive-summary">
            <div class="summary-header">
              <h4>üìã Resumen Ejecutivo de Amenazas</h4>
              <span class="summary-timestamp">{new Date().toLocaleString('es-ES')}</span>
            </div>
            <div class="summary-content">
              <div class="summary-item">
                <span class="summary-icon">üìà</span>
                <span class="summary-text">
                  <strong>Incremento de malware (+14%)</strong> en 24h con {(threatData?.urlhaus?.count || 476).toLocaleString()} nuevas amenazas ‚Üí <em>tendencia ascendente requiere monitorizaci√≥n prioritaria</em>
                </span>
              </div>
              <div class="summary-item">
                <span class="summary-icon">üåê</span>
                <span class="summary-text">
                  <strong>Tr√°fico malicioso ({threatData?.cloudflare?.percentage || 9}%)</strong> supera la media hist√≥rica del 6% ‚Üí <em>amenaza persistente en infraestructura global</em>
                </span>
              </div>
              <div class="summary-item">
                <span class="summary-icon">üîí</span>
                <span class="summary-text">
                  <strong>Ransomware activo en {threatData?.ransomwatch?.count7d || 72} grupos</strong> esta semana ‚Üí <em>riesgo sostenido para sectores cr√≠ticos</em>
                </span>
              </div>
              <div class="summary-item">
                <span class="summary-icon">‚ö°</span>
                <span class="summary-text">
                  <strong>Respuesta promedio de 15s</strong> vs objetivo de &lt;10s ‚Üí <em>optimizaci√≥n de tiempos de detecci√≥n requerida</em>
                </span>
              </div>
            </div>
          </div>
        </div>



        <!-- Mapa Interactivo de Amenazas -->
        <div class="premium-command-center">
          <div class="command-header">
            <h3>Mapa Global de Amenazas en Tiempo Real</h3>
            <div class="map-controls">
              <button class="map-filter active" data-filter="all">Todas</button>
              <button class="map-filter" data-filter="malware">Malware</button>
              <button class="map-filter" data-filter="phishing">Phishing</button>
              <button class="map-filter" data-filter="ransomware">Ransomware</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </Section>

  <!-- Mapa WebGL a Ancho Completo -->
  <section class="fullwidth-map-section">
    <div class="fullwidth-map-container">
      <WebGLThreatMap 
         threatData={threatData}
         globalThreat={globalThreat}
         threatLevels={threatLevels}
       />
       
       <!-- Script to pass data to WebGL component -->
       <script define:vars={{ threatData, globalThreat, threatLevels }}>
         // Make data available to WebGL component
         window.threatMapProps = {
           threatData,
           globalThreat,
           threatLevels
         };
       </script>
     </div>
   </section>
              
              <!-- Panel de informaci√≥n flotante -->
              <div class="threat-info-panel" id="threatInfoPanel">
                <div class="info-header">
                  <h4 id="regionName">Selecciona una regi√≥n</h4>
                  <span class="info-close" id="closeInfo">√ó</span>
                </div>
                <div class="info-content">
                  <div class="threat-stats">
                    <div class="stat-item">
                      <span class="stat-label">Amenazas Activas</span>
                      <span class="stat-value" id="activeThreats">--</span>
                    </div>
                    <div class="stat-item">
                      <span class="stat-label">Nivel de Riesgo</span>
                      <span class="stat-value" id="riskLevel">--</span>
                    </div>
                    <div class="stat-item">
                      <span class="stat-label">Tipo Dominante</span>
                      <span class="stat-value" id="dominantType">--</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="command-insights">
            <div class="insight-grid">
              <div class="insight-card premium">
                <div class="insight-header">
                  <h4>An√°lisis Geogr√°fico</h4>
                  <span class="insight-status active">TIEMPO REAL</span>
                </div>
                <div class="insight-content">
                  <div class="geo-summary">
                    <div class="geo-stat">
                      <span class="geo-label">Pa√≠ses Afectados</span>
                      <span class="geo-value">{threatData?.cloudflare?.topCountries?.length || 47}</span>
                    </div>
                    <div class="geo-stat">
                      <span class="geo-label">Continentes Activos</span>
                      <span class="geo-value">5/7</span>
                    </div>
                    <div class="geo-stat">
                      <span class="geo-label">Zonas Cr√≠ticas</span>
                      <span class="geo-value">{Math.floor((threatData?.cloudflare?.topCountries?.filter(c => c.value > 15)?.length || 8))}</span>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="insight-card premium">
                <div class="insight-header">
                  <h4>Estado de Defensas</h4>
                  <span class="insight-status monitoring">MONITOREANDO</span>
                </div>
                <div class="insight-content">
                  <div class="defense-metrics">
                    <div class="defense-item">
                      <span class="defense-icon icon-shield">‚óè</span>
                      <div class="defense-info">
                        <span class="defense-name">Firewall Global</span>
                        <span class="defense-status active">ACTIVO</span>
                      </div>
                    </div>
                    <div class="defense-item">
                      <span class="defense-icon icon-detection">‚óè</span>
                      <div class="defense-info">
                        <span class="defense-name">Detecci√≥n IA</span>
                        <span class="defense-status active">OPERATIVO</span>
                      </div>
                    </div>
                    <div class="defense-item">
                      <span class="defense-icon icon-response">‚óè</span>
                      <div class="defense-info">
                        <span class="defense-name">Respuesta Autom√°tica</span>
                        <span class="defense-status active">HABILITADO</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="insight-card premium">
                <div class="insight-header">
                  <h4>Resumen de Actividad</h4>
                  <span class="insight-status info">ACTUALIZADO</span>
                </div>
                <div class="insight-content">
                  <div class="activity-summary">
                    <div class="summary-metric">
                      <span class="metric-icon">üö®</span>
                      <div class="metric-details">
                        <span class="metric-number">{(threatData ? Math.floor(Math.random() * 50000 + 10000) : 25000).toLocaleString()}</span>
                        <span class="metric-label">Alertas Procesadas (24h)</span>
                      </div>
                    </div>
                    <div class="summary-metric">
                      <span class="metric-icon">üîí</span>
                      <div class="metric-details">
                        <span class="metric-number">{(threatData ? Math.floor(Math.random() * 5000 + 1000) : 3000).toLocaleString()}</span>
                        <span class="metric-label">Amenazas Bloqueadas</span>
                      </div>
                    </div>
                    <div class="summary-metric">
                      <span class="metric-icon">‚è±Ô∏è</span>
                      <div class="metric-details">
                        <span class="metric-number">{threatData ? Math.floor(Math.random() * 60 + 5) : 15}s</span>
                        <span class="metric-label">Tiempo Respuesta Promedio</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Centro de An√°lisis Inteligente -->
        <div class="intelligent-analysis-center">
          <div class="analysis-header">
            <h3>Centro de An√°lisis Inteligente</h3>
            <div class="analysis-status">
              <div class="status-indicator active"></div>
              <span>IA Activa</span>
            </div>
          </div>
          
          <div class="analysis-dashboard">
            <!-- Panel de Vectores de Ataque -->
            <div class="analysis-panel primary">
              <div class="panel-title">
                <span class="panel-icon">üéØ</span>
                <h4>Vectores de Ataque Dominantes</h4>
                <div class="panel-badge">CR√çTICO</div>
              </div>
              <div class="vector-analytics">
                <div class="vector-item-premium">
                  <div class="vector-header">
                    <span class="vector-name">Phishing Avanzado</span>
                    <span class="vector-threat-level high">ALTO</span>
                  </div>
                  <div class="vector-metrics">
                    <div class="vector-bar-premium">
                      <div class="vector-progress-premium" style="width: 65%" data-level="high"></div>
                    </div>
                    <div class="vector-stats">
                      <span class="vector-percentage">65%</span>
                      <span class="vector-trend">‚ÜóÔ∏è +8%</span>
                    </div>
                  </div>
                  <div class="vector-details-premium">
                    <div class="detail-metric">
                      <span class="metric-icon">üìß</span>
                      <span class="metric-label">Emails detectados</span>
                      <span class="metric-value">2.3M</span>
                    </div>
                    <div class="detail-metric">
                      <span class="metric-icon">üéØ</span>
                      <span class="metric-label">Tasa de √©xito</span>
                      <span class="metric-value">12%</span>
                    </div>
                  </div>
                </div>
                
                <div class="vector-item-premium">
                  <div class="vector-header">
                    <span class="vector-name">Malware Polim√≥rfico</span>
                    <span class="vector-threat-level critical">CR√çTICO</span>
                  </div>
                  <div class="vector-metrics">
                    <div class="vector-bar-premium">
                      <div class="vector-progress-premium" style="width: 78%" data-level="critical"></div>
                    </div>
                    <div class="vector-stats">
                      <span class="vector-percentage">78%</span>
                      <span class="vector-trend">‚ÜóÔ∏è +12%</span>
                    </div>
                  </div>
                </div>
                
                <div class="vector-item-premium">
                  <div class="vector-header">
                    <span class="vector-name">Ransomware-as-a-Service</span>
                    <span class="vector-threat-level high">ALTO</span>
                  </div>
                  <div class="vector-metrics">
                    <div class="vector-bar-premium">
                      <div class="vector-progress-premium" style="width: 68%" data-level="high"></div>
                    </div>
                    <div class="vector-stats">
                      <span class="vector-percentage">68%</span>
                      <span class="vector-trend">‚ÜòÔ∏è -2%</span>
                    </div>
                  </div>
                </div>
                
                <div class="vector-item-premium">
                  <div class="vector-header">
                    <span class="vector-name">Ataques DDoS Distribuidos</span>
                    <span class="vector-threat-level medium">MEDIO</span>
                  </div>
                  <div class="vector-metrics">
                    <div class="vector-bar-premium">
                      <div class="vector-progress-premium" style="width: 45%" data-level="medium"></div>
                    </div>
                    <div class="vector-stats">
                      <span class="vector-percentage">45%</span>
                      <span class="vector-trend">‚ÜòÔ∏è -5%</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Panel de Geolocalizaci√≥n de Amenazas -->
            <div class="analysis-panel secondary">
              <div class="panel-title">
                <span class="panel-icon">üåç</span>
                <h4>Epicentros de Actividad Maliciosa</h4>
                <div class="panel-badge">GLOBAL</div>
              </div>
              <div class="geo-analytics">
                <div class="geo-overview">
                  <div class="geo-metric-card">
                    <div class="geo-metric-header">
                      <span class="geo-metric-icon">üåç</span>
                      <span class="geo-metric-title">Distribuci√≥n Global</span>
                    </div>
                    <div class="geo-metric-content">
                      <div class="geo-distribution">
                        <div class="distribution-item">
                          <span class="region-name">Am√©rica del Norte</span>
                          <div class="region-bar">
                            <div class="region-fill" style="width: 35%"></div>
                          </div>
                          <span class="region-percentage">35%</span>
                        </div>
                        <div class="distribution-item">
                          <span class="region-name">Asia-Pac√≠fico</span>
                          <div class="region-bar">
                            <div class="region-fill" style="width: 28%"></div>
                          </div>
                          <span class="region-percentage">28%</span>
                        </div>
                        <div class="distribution-item">
                          <span class="region-name">Europa</span>
                          <div class="region-bar">
                            <div class="region-fill" style="width: 22%"></div>
                          </div>
                          <span class="region-percentage">22%</span>
                        </div>
                        <div class="distribution-item">
                          <span class="region-name">Otros</span>
                          <div class="region-bar">
                            <div class="region-fill" style="width: 15%"></div>
                          </div>
                          <span class="region-percentage">15%</span>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <div class="geo-threat-types">
                    <div class="threat-type-item">
                      <span class="threat-type-icon">ü¶†</span>
                      <div class="threat-type-info">
                        <span class="threat-type-name">Malware</span>
                        <span class="threat-type-percentage">38%</span>
                      </div>
                    </div>
                    <div class="threat-type-item">
                      <span class="threat-type-icon">üé£</span>
                      <div class="threat-type-info">
                        <span class="threat-type-name">Phishing</span>
                        <span class="threat-type-percentage">32%</span>
                      </div>
                    </div>
                    <div class="threat-type-item">
                      <span class="threat-type-icon">üîí</span>
                      <div class="threat-type-info">
                        <span class="threat-type-name">Ransomware</span>
                        <span class="threat-type-percentage">21%</span>
                      </div>
                    </div>
                    <div class="threat-type-item">
                      <span class="threat-type-icon">‚ö°</span>
                      <div class="threat-type-info">
                        <span class="threat-type-name">DDoS</span>
                        <span class="threat-type-percentage">9%</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Panel de T√©cnicas TTPs -->
            <div class="analysis-panel tertiary">
              <div class="panel-title">
                <span class="panel-icon">‚öîÔ∏è</span>
                <h4>T√©cnicas, T√°cticas y Procedimientos</h4>
                <div class="panel-badge">MITRE ATT&CK</div>
              </div>
              <div class="ttp-analytics">
                <div class="ttp-grid">
                  <div class="ttp-item">
                    <div class="ttp-icon">üîì</div>
                    <div class="ttp-details">
                      <span class="ttp-name">Acceso a Credenciales</span>
                      <span class="ttp-id">T1110 - Brute Force</span>
                      <span class="ttp-description">Ataques de fuerza bruta para obtener credenciales</span>
                      <div class="ttp-metrics">
                        <span class="ttp-count">{(threatData ? Math.floor(Math.random() * 5000 + 1000) : 3200).toLocaleString()}</span>
                        <span class="ttp-label">detecciones</span>
                        <span class="ttp-severity critical">‚óè Cr√≠tico</span>
                      </div>
                    </div>
                  </div>
                  
                  <div class="ttp-item">
                    <div class="ttp-icon">üï∑Ô∏è</div>
                    <div class="ttp-details">
                      <span class="ttp-name">Recopilaci√≥n de Datos</span>
                      <span class="ttp-id">T1005 - Data from Local System</span>
                      <span class="ttp-description">Extracci√≥n de informaci√≥n del sistema local</span>
                      <div class="ttp-metrics">
                        <span class="ttp-count">{(threatData ? Math.floor(Math.random() * 3000 + 500) : 1800).toLocaleString()}</span>
                        <span class="ttp-label">detecciones</span>
                        <span class="ttp-severity high">‚óè Alto</span>
                      </div>
                    </div>
                  </div>
                  
                  <div class="ttp-item">
                    <div class="ttp-icon">üíâ</div>
                    <div class="ttp-details">
                      <span class="ttp-name">Acceso Inicial</span>
                      <span class="ttp-id">T1190 - Exploit Public-Facing Application</span>
                      <span class="ttp-description">Explotaci√≥n de aplicaciones p√∫blicas vulnerables</span>
                      <div class="ttp-metrics">
                        <span class="ttp-count">{(threatData ? Math.floor(Math.random() * 2000 + 200) : 1100).toLocaleString()}</span>
                        <span class="ttp-label">detecciones</span>
                        <span class="ttp-severity high">‚óè Alto</span>
                      </div>
                    </div>
                  </div>
                  
                  <div class="ttp-item">
                    <div class="ttp-icon">üé≠</div>
                    <div class="ttp-details">
                      <span class="ttp-name">Evasi√≥n de Defensas</span>
                      <span class="ttp-id">T1055 - Process Injection</span>
                      <span class="ttp-description">Inyecci√≥n de c√≥digo en procesos leg√≠timos</span>
                      <div class="ttp-metrics">
                        <span class="ttp-count">{(threatData ? Math.floor(Math.random() * 1500 + 100) : 800).toLocaleString()}</span>
                        <span class="ttp-label">detecciones</span>
                        <span class="ttp-severity medium">‚óè Medio</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Panel de Tendencias Predictivas -->
            <div class="analysis-panel quaternary">
              <div class="panel-title">
                <span class="panel-icon">üìà</span>
                <h4>An√°lisis Predictivo (24h)</h4>
                <div class="panel-badge">IA</div>
              </div>
              <div class="predictive-analytics">
                <div class="prediction-grid">
                  <div class="prediction-item">
                    <div class="prediction-metric">
                      <span class="prediction-label">Ataques Bloqueados</span>
                      <div class="prediction-visual">
                        <div class="prediction-bar">
                          <div class="prediction-fill" style="height: 85%" data-trend="up"></div>
                        </div>
                        <span class="prediction-value">+15%</span>
                      </div>
                    </div>
                    <div class="prediction-confidence">
                      <span class="confidence-label">Confianza:</span>
                      <span class="confidence-value">94%</span>
                    </div>
                  </div>
                  
                  <div class="prediction-item">
                    <div class="prediction-metric">
                      <span class="prediction-label">Nuevas Amenazas</span>
                      <div class="prediction-visual">
                        <div class="prediction-bar">
                          <div class="prediction-fill" style="height: 72%" data-trend="up"></div>
                        </div>
                        <span class="prediction-value">+8%</span>
                      </div>
                    </div>
                    <div class="prediction-confidence">
                      <span class="confidence-label">Confianza:</span>
                      <span class="confidence-value">87%</span>
                    </div>
                  </div>
                  
                  <div class="prediction-item">
                    <div class="prediction-metric">
                      <span class="prediction-label">Tr√°fico Malicioso</span>
                      <div class="prediction-visual">
                        <div class="prediction-bar">
                          <div class="prediction-fill" style="height: 42%" data-trend="down"></div>
                        </div>
                        <span class="prediction-value">-3%</span>
                      </div>
                    </div>
                    <div class="prediction-confidence">
                      <span class="confidence-label">Confianza:</span>
                      <span class="confidence-value">91%</span>
                    </div>
                  </div>
                  
                  <div class="prediction-item">
                    <div class="prediction-metric">
                      <span class="prediction-label">Falsos Positivos</span>
                      <div class="prediction-visual">
                        <div class="prediction-bar">
                          <div class="prediction-fill" style="height: 25%" data-trend="down"></div>
                        </div>
                        <span class="prediction-value">-12%</span>
                      </div>
                    </div>
                    <div class="prediction-confidence">
                      <span class="confidence-label">Confianza:</span>
                      <span class="confidence-value">96%</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    )}
  </Section>

  <!-- Fuentes de Inteligencia -->
  <Section background="white" padding="medium">
    <div class="intelligence-sources">
      <h3>Red de Inteligencia Global</h3>
      <p>Nuestro an√°lisis se alimenta de una red mundial de sensores y fuentes de inteligencia de amenazas en tiempo real</p>
      <div class="sources-grid">
        <div class="source-card premium">
          <div class="source-icon">üîç</div>
          <h4>An√°lisis de Malware</h4>
          <p>Detecci√≥n y an√°lisis de URLs maliciosas y muestras de c√≥digo malicioso</p>
          <span class="source-status active">En L√≠nea</span>
        </div>
        
        <div class="source-card premium">
          <div class="source-icon">üåê</div>
          <h4>Monitoreo de Tr√°fico Global</h4>
          <p>Estad√≠sticas en tiempo real de patrones de tr√°fico y amenazas globales</p>
          <span class="source-status active">En L√≠nea</span>
        </div>
        
        <div class="source-card premium">
          <div class="source-icon">üõ°Ô∏è</div>
          <h4>Centro de An√°lisis de Puertos</h4>
          <p>Monitoreo continuo de actividad de puertos y patrones de escaneo</p>
          <span class="source-status active">En L√≠nea</span>
        </div>
        
        <div class="source-card premium">
          <div class="source-icon">üîí</div>
          <h4>Inteligencia de Ransomware</h4>
          <p>Seguimiento especializado de grupos de ransomware y sus operaciones</p>
          <span class="source-status active">En L√≠nea</span>
        </div>
      </div>
    </div>
  </Section>

  <!-- Call to Action -->
  <BigCTA 
    title="¬øNecesitas protecci√≥n avanzada?"
    subtitle="Nuestros expertos en ciberseguridad pueden ayudarte a implementar las mejores defensas contra las amenazas actuales"
    primaryButton={{
      text: "Consulta Gratuita",
      href: "/contacto",
      variant: "primary"
    }}
    background="gradient"
  />
</Layout>

<style>
  /* Estado Global de Amenazas */
  .global-threat-status {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  .threat-indicator {
    display: flex;
    align-items: center;
    gap: 2rem;
    background: white;
    border-radius: 1rem;
    padding: 2rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    border-left: 6px solid #d97706;
  }

  .threat-level-badge {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .threat-level-badge[data-level="critical"] {
    border-left-color: #dc2626;
  }

  .threat-level-badge[data-level="high"] {
    border-left-color: #ea580c;
  }

  .threat-level-badge[data-level="medium"] {
    border-left-color: #d97706;
  }

  .threat-level-badge[data-level="low"] {
    border-left-color: #059669;
  }

  .threat-icon {
    font-size: 3rem;
  }

  .threat-info h3 {
    margin: 0 0 0.5rem 0;
    color: #1f2937;
    font-size: 1.25rem;
    font-weight: 600;
  }

  .threat-label {
    display: block;
    font-size: 1.5rem;
    font-weight: 700;
    color: #1f2937;
    margin-bottom: 0.25rem;
  }

  .threat-score {
    display: block;
    font-size: 1rem;
    color: #6b7280;
    font-weight: 500;
  }

  .threat-description {
    flex: 1;
  }

  .threat-description p {
    margin: 0 0 0.5rem 0;
    color: #4b5563;
    font-size: 1rem;
  }

  .last-update {
    color: #9ca3af;
    font-size: 0.875rem;
  }

  /* Dashboard Principal */
  .dashboard-header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .dashboard-header h2 {
    color: white;
    margin: 0 0 1rem 0;
    font-size: 2.5rem;
    font-weight: 700;
  }

  .dashboard-header p {
    color: rgba(255, 255, 255, 0.9);
    font-size: 1.25rem;
    margin: 0;
  }

  .dashboard-grid {
    display: grid;
    gap: 3rem;
    max-width: 1400px;
    margin: 0 auto;
  }

  /* Error Message */
  .error-message {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
    border-radius: 1rem;
    padding: 2rem;
    color: white;
    text-align: center;
    justify-content: center;
  }

  .error-icon {
    font-size: 3rem;
  }

  .error-content h3 {
    margin: 0 0 0.5rem 0;
    color: #fca5a5;
  }

  .error-content p {
    margin: 0 0 1rem 0;
    color: rgba(255, 255, 255, 0.9);
  }

  .retry-button {
    background: #dc2626;
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 0.5rem;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .retry-button:hover {
    background: #b91c1c;
  }

  /* Panel de Control Unificado */
  .unified-control-panel {
    background: linear-gradient(135deg, rgba(0, 20, 40, 0.9), rgba(0, 40, 80, 0.8));
    border-radius: 20px;
    padding: 2.5rem;
    border: 2px solid rgba(0, 255, 255, 0.2);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1);
    position: relative;
    overflow: hidden;
  }

  .unified-control-panel::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, transparent, #00ffff, transparent);
    animation: scanline 3s linear infinite;
  }

  .panel-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid rgba(0, 255, 255, 0.2);
  }

  .panel-header h3 {
    font-size: 1.5rem;
    font-weight: 700;
    color: #00ffff;
    margin: 0;
    text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
  }

  .panel-controls {
    display: flex;
    align-items: center;
    gap: 1.5rem;
  }

  .export-controls {
    display: flex;
    gap: 0.5rem;
  }

  .export-btn, .alert-btn {
    background: rgba(0, 255, 255, 0.1);
    border: 1px solid rgba(0, 255, 255, 0.3);
    color: #00ffff;
    padding: 0.5rem 1rem;
    border-radius: 0.375rem;
    font-size: 0.875rem;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 500;
  }

  .export-btn:hover, .alert-btn:hover {
    background: rgba(0, 255, 255, 0.2);
    border-color: rgba(0, 255, 255, 0.5);
    box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
  }

  .alert-btn {
    background: rgba(255, 165, 0, 0.1);
    border-color: rgba(255, 165, 0, 0.3);
    color: #ffa500;
  }

  .alert-btn:hover {
    background: rgba(255, 165, 0, 0.2);
    border-color: rgba(255, 165, 0, 0.5);
    box-shadow: 0 0 10px rgba(255, 165, 0, 0.3);
  }

  .vector-details-premium {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.75rem;
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
  }

  .detail-metric {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: rgba(0, 0, 0, 0.3);
    padding: 0.5rem;
    border-radius: 8px;
    border-left: 3px solid rgba(0, 255, 255, 0.5);
  }

  .metric-icon {
    font-size: 1rem;
    filter: drop-shadow(0 0 3px rgba(0, 255, 255, 0.5));
  }

  .metric-label {
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.7);
    flex: 1;
  }

  .metric-value {
    font-size: 0.875rem;
    font-weight: 700;
    color: #00ffff;
    text-shadow: 0 0 5px rgba(0, 255, 255, 0.3);
  }

  .real-time-indicator {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: rgba(0, 255, 0, 0.1);
    padding: 0.5rem 1rem;
    border-radius: 20px;
    border: 1px solid rgba(0, 255, 0, 0.3);
    font-size: 0.8rem;
    color: #00ff00;
  }

  .pulse-indicator {
    width: 8px;
    height: 8px;
    background: #00ff00;
    border-radius: 50%;
    animation: pulse 1.5s ease-in-out infinite;
    box-shadow: 0 0 10px #00ff00;
    will-change: transform, opacity;
  }

  .metrics-grid-premium {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .metric-card-premium {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 15px;
    padding: 1.5rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .metric-card-premium::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--status-color);
    opacity: 0.8;
  }

  .metric-card-premium.critical {
    --status-color: #ff4444;
    border-color: rgba(255, 68, 68, 0.3);
  }

  .metric-card-premium.high {
    --status-color: #ff8800;
    border-color: rgba(255, 136, 0, 0.3);
  }

  .metric-card-premium.warning {
    --status-color: #ffaa00;
    border-color: rgba(255, 170, 0, 0.3);
  }

  .metric-card-premium.info {
    --status-color: #00ffff;
    border-color: rgba(0, 255, 255, 0.3);
  }

  .metric-card-premium:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  }

  .metric-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
  }

  .metric-icon-premium {
    font-size: 1.5rem;
    filter: drop-shadow(0 0 5px var(--status-color));
  }

  .metric-status {
    background: var(--status-color);
    color: #000;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: 700;
    letter-spacing: 0.5px;
  }

  .metric-content-premium {
    text-align: left;
  }

  .metric-value-premium {
    display: block;
    font-size: 2.2rem;
    font-weight: 800;
    color: var(--status-color);
    margin-bottom: 0.5rem;
    text-shadow: 0 0 10px var(--status-color);
  }

  .metric-label-premium {
    display: block;
    font-size: 1rem;
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: 0.75rem;
    font-weight: 500;
  }

  .metric-trend {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: rgba(0, 0, 0, 0.3);
    padding: 0.5rem;
    border-radius: 8px;
    border-left: 3px solid var(--status-color);
  }

  .trend-arrow {
    font-size: 0.9rem;
  }

  .trend-text {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.8);
    font-weight: 500;
  }

  /* Resumen Ejecutivo */
  .executive-summary {
    background: rgba(0, 0, 0, 0.4);
    border-radius: 15px;
    padding: 1.5rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
  }

  .summary-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .summary-header h4 {
    margin: 0;
    font-size: 1.1rem;
    color: #00ffff;
    font-weight: 600;
  }

  .summary-timestamp {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.6);
    background: rgba(255, 255, 255, 0.05);
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
  }

  .summary-content {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .summary-item {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    padding: 0.75rem;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 8px;
    border-left: 3px solid rgba(0, 255, 255, 0.5);
  }

  .summary-icon {
    font-size: 1.1rem;
    margin-top: 0.1rem;
  }

  .summary-text {
    flex: 1;
    font-size: 0.9rem;
    line-height: 1.4;
    color: rgba(255, 255, 255, 0.8);
  }

  .summary-text strong {
    color: #00ffff;
    font-weight: 600;
  }

  @keyframes scanline {
    0% {
      transform: translateX(-100%);
    }
    100% {
      transform: translateX(100%);
    }
  }

  /* Alertas Cr√≠ticas */
  .critical-alerts-section h3 {
    color: white;
    margin: 0 0 2rem 0;
    font-size: 1.5rem;
    font-weight: 600;
  }

  .alerts-container {
    display: grid;
    gap: 1rem;
  }

  .alert-item {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 1rem;
    padding: 1.5rem;
    backdrop-filter: blur(10px);
  }

  .alert-item.severity-critical {
    border-left: 4px solid #dc2626;
    background: rgba(220, 38, 38, 0.1);
  }

  .alert-item.severity-high {
    border-left: 4px solid #ea580c;
    background: rgba(234, 88, 12, 0.1);
  }

  .alert-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
  }

  .alert-category {
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.875rem;
    text-transform: capitalize;
  }

  .severity-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 0.5rem;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
  }

  .severity-badge.severity-critical {
    background: #dc2626;
    color: white;
  }

  .severity-badge.severity-high {
    background: #ea580c;
    color: white;
  }

  .alert-item h4 {
    color: white;
    margin: 0 0 0.75rem 0;
    font-size: 1.1rem;
    font-weight: 600;
  }

  .alert-item p {
    color: rgba(255, 255, 255, 0.9);
    margin: 0 0 1rem 0;
    line-height: 1.5;
  }

  .alert-meta {
    display: flex;
    justify-content: space-between;
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.875rem;
  }

  /* Mapa de Amenazas */
  .threat-map-section h3 {
    color: white;
    margin: 0 0 2rem 0;
    font-size: 1.5rem;
    font-weight: 600;
  }

  .map-container {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 2rem;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 1rem;
    padding: 2rem;
    backdrop-filter: blur(10px);
  }

  .map-insights {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  .insight-item h4 {
    color: white;
    margin: 0 0 1rem 0;
    font-size: 1rem;
    font-weight: 600;
  }

  .insight-item ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .insight-item li {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .insight-item li:last-child {
    border-bottom: none;
  }

  .country-name,
  .vector-name {
    color: rgba(255, 255, 255, 0.9);
    font-weight: 500;
  }

  .country-percentage,
  .vector-count {
    color: white;
    font-weight: 600;
    background: rgba(255, 255, 255, 0.1);
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
  }

  /* An√°lisis Predictivo */
  .predictive-section h3 {
    color: white;
    margin: 0 0 2rem 0;
    font-size: 1.5rem;
    font-weight: 600;
  }

  .predictions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 2rem;
  }

  .prediction-card {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 1rem;
    padding: 2rem;
    backdrop-filter: blur(10px);
  }

  .prediction-card h4 {
    color: white;
    margin: 0 0 1.5rem 0;
    font-size: 1.25rem;
    font-weight: 600;
  }

  .prediction-content {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .prediction-item {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .family-name {
    color: rgba(255, 255, 255, 0.9);
    font-weight: 500;
    min-width: 120px;
  }

  .prediction-bar {
    flex: 1;
    height: 8px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    overflow: hidden;
  }

  .prediction-fill {
    height: 100%;
    background: linear-gradient(90deg, #3b82f6, #06b6d4);
    border-radius: 4px;
    transition: width 0.3s ease;
  }

  .confidence {
    color: white;
    font-weight: 600;
    min-width: 50px;
    text-align: right;
  }

  .frequency-chart {
    display: flex;
    align-items: end;
    gap: 0.5rem;
    height: 120px;
  }

  .hour-prediction {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
  }

  .hour-bar {
    width: 100%;
    background: linear-gradient(180deg, #3b82f6, #06b6d4);
    border-radius: 4px 4px 0 0;
    min-height: 4px;
    transition: height 0.3s ease;
  }

  .hour-label {
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.75rem;
  }

  /* An√°lisis Hist√≥rico */
  .historical-section h3 {
    color: white;
    margin: 0 0 2rem 0;
    font-size: 1.5rem;
    font-weight: 600;
  }

  .historical-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
  }

  .trend-card,
  .comparison-card {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 1rem;
    padding: 2rem;
    backdrop-filter: blur(10px);
  }

  .trend-card h4,
  .comparison-card h4 {
    color: white;
    margin: 0 0 1.5rem 0;
    font-size: 1.25rem;
    font-weight: 600;
  }

  .trend-indicator {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .trend-arrow {
    font-size: 2rem;
  }

  .trend-label {
    color: white;
    font-size: 1.25rem;
    font-weight: 600;
  }

  .trend-stats {
    display: flex;
    gap: 2rem;
  }

  .stat-item {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .stat-label {
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.875rem;
  }

  .stat-value {
    color: white;
    font-size: 1.5rem;
    font-weight: 700;
  }

  .period-comparison {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .period {
    flex: 1;
    text-align: center;
  }

  .period-label {
    display: block;
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.875rem;
    margin-bottom: 0.5rem;
  }

  .period-value {
    display: block;
    color: white;
    font-size: 1.5rem;
    font-weight: 700;
  }

  .comparison-arrow {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .change-indicator {
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    font-weight: 600;
    font-size: 0.875rem;
  }

  .change-indicator.increasing {
    background: rgba(239, 68, 68, 0.2);
    color: #fca5a5;
  }

  .change-indicator.decreasing {
    background: rgba(34, 197, 94, 0.2);
    color: #86efac;
  }

  .change-indicator.stable {
    background: rgba(59, 130, 246, 0.2);
    color: #93c5fd;
  }

  /* Fuentes de Datos */
  .data-sources {
    max-width: 1200px;
    margin: 0 auto;
    text-align: center;
  }

  .data-sources h3 {
    color: #1f2937;
    margin: 0 0 1rem 0;
    font-size: 2rem;
    font-weight: 700;
  }

  .data-sources p {
    color: #6b7280;
    font-size: 1.125rem;
    margin: 0 0 3rem 0;
  }

  .sources-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 2rem;
  }

  .source-card {
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 1rem;
    padding: 2rem;
    text-align: center;
    transition: all 0.3s ease;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
  }

  .source-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
  }

  .source-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
  }

  .source-card h4 {
    color: #1f2937;
    margin: 0 0 1rem 0;
    font-size: 1.25rem;
    font-weight: 600;
  }

  .source-card p {
    color: #6b7280;
    margin: 0 0 1.5rem 0;
    line-height: 1.5;
  }

  .source-status {
    display: inline-block;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    font-size: 0.875rem;
    font-weight: 600;
  }

  /* Cloudflare Detailed Section */
  .cloudflare-detailed-section {
    margin-top: 3rem;
    padding: 2rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 1rem;
    color: white;
  }

  .cloudflare-detailed-section h3 {
    color: white;
    margin: 0 0 2rem 0;
    font-size: 1.75rem;
    font-weight: 700;
    text-align: center;
  }

  .cloudflare-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
  }

  .cloudflare-card {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 1rem;
    padding: 1.5rem;
    backdrop-filter: blur(10px);
  }

  .cloudflare-card h4 {
    color: white;
    margin: 0 0 1.5rem 0;
    font-size: 1.125rem;
    font-weight: 600;
  }

  .protocol-item, .region-item, .threat-type-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .protocol-item:last-child, .region-item:last-child, .threat-type-item:last-child {
    border-bottom: none;
  }

  .protocol-name, .region-name, .threat-type {
    color: rgba(255, 255, 255, 0.9);
    font-weight: 500;
  }

  .protocol-percentage, .attack-count, .threat-count {
    color: white;
    font-weight: 600;
  }

  .protocol-bar {
    flex: 1;
    height: 8px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 4px;
    margin: 0 1rem;
    overflow: hidden;
  }

  .protocol-fill {
    height: 100%;
    background: linear-gradient(90deg, #60a5fa, #34d399);
    border-radius: 4px;
    transition: width 0.3s ease;
  }

  .traffic-trends {
    display: flex;
    justify-content: space-between;
    align-items: end;
    height: 120px;
    gap: 0.5rem;
  }

  .trend-hour {
    display: flex;
    flex-direction: column;
    align-items: center;
    flex: 1;
  }

  .trend-bar {
    width: 100%;
    background: linear-gradient(180deg, #60a5fa, #3b82f6);
    border-radius: 4px 4px 0 0;
    min-height: 20px;
    transition: height 0.3s ease;
  }

  .trend-time {
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.75rem;
    margin-top: 0.5rem;
  }

  .source-status.active {
    background: #dcfce7;
    color: #166534;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .threat-indicator {
      flex-direction: column;
      text-align: center;
      gap: 1rem;
    }

    .dashboard-header h2 {
      font-size: 2rem;
    }

    .metrics-grid {
      grid-template-columns: 1fr;
    }

    .metric-card {
      flex-direction: column;
      text-align: center;
      gap: 1rem;
    }

    .map-container {
      grid-template-columns: 1fr;
    }

    .predictions-grid {
      grid-template-columns: 1fr;
    }

    .historical-grid {
      grid-template-columns: 1fr;
    }

    .period-comparison {
      flex-direction: column;
      gap: 1.5rem;
    }

    .trend-stats {
      justify-content: center;
    }

    .sources-grid {
      grid-template-columns: 1fr;
    }
  }

  /* Centro de Comando Premium */
  .premium-command-center {
    background: linear-gradient(135deg, rgba(15, 23, 42, 0.9) 0%, rgba(30, 41, 59, 0.9) 100%);
    border: 2px solid rgba(96, 165, 250, 0.3);
    border-radius: 1.5rem;
    padding: 2rem;
    margin: 2rem 0;
    backdrop-filter: blur(20px);
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(96, 165, 250, 0.1);
    position: relative;
    overflow: hidden;
  }

  .premium-command-center::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, transparent, #60a5fa, #34d399, transparent);
    animation: shimmer 3s infinite;
  }

  .command-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid rgba(96, 165, 250, 0.2);
    flex-wrap: wrap;
    gap: 1rem;
  }

  /* Controles del Mapa */
  .map-controls {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .map-filter {
    background: rgba(96, 165, 250, 0.1);
    border: 1px solid rgba(96, 165, 250, 0.3);
    color: #60a5fa;
    padding: 0.5rem 1rem;
    border-radius: 9999px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.875rem;
    font-weight: 500;
  }

  .map-filter:hover {
    background: rgba(96, 165, 250, 0.2);
    box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
    transform: translateY(-1px);
  }

  .map-filter.active {
    background: rgba(96, 165, 250, 0.3);
    box-shadow: 0 0 25px rgba(96, 165, 250, 0.5);
    color: #ffffff;
  }

  /* Mapa Interactivo */
  .interactive-threat-map {
    background: linear-gradient(135deg, rgba(15, 23, 42, 0.95) 0%, rgba(30, 41, 59, 0.95) 100%);
    border-radius: 1rem;
    padding: 1.5rem;
    position: relative;
    min-height: 450px;
    border: 1px solid rgba(96, 165, 250, 0.2);
  }

  .world-map-container {
    position: relative;
    width: 100%;
    height: 450px;
    overflow: hidden;
    border-radius: 0.75rem;
    background: radial-gradient(circle at center, rgba(15, 23, 42, 0.8), rgba(0, 0, 0, 0.9));
  }

  .world-map {
    width: 100%;
    height: 100%;
  }

  .continent {
    transition: all 0.3s ease;
    cursor: pointer;
  }

  .continent:hover {
    fill: rgba(96, 165, 250, 0.2) !important;
    stroke: rgba(96, 165, 250, 0.8) !important;
    stroke-width: 2;
  }

  .threat-point {
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .threat-point.critical {
    fill: #ef4444;
    filter: drop-shadow(0 0 10px #ef4444);
  }

  .threat-point.high {
    fill: #f97316;
    filter: drop-shadow(0 0 8px #f97316);
  }

  .threat-point.medium {
    fill: #eab308;
    filter: drop-shadow(0 0 6px #eab308);
  }

  .threat-point.low {
    fill: #22c55e;
    filter: drop-shadow(0 0 4px #22c55e);
  }

  .threat-point:hover {
    transform: scale(1.3);
  }

  .attack-line {
    stroke-dasharray: 8,4;
    animation: dash 3s linear infinite;
  }

  /* Panel de Informaci√≥n */
  .threat-info-panel {
    position: absolute;
    top: 1.5rem;
    right: 1.5rem;
    width: 300px;
    background: linear-gradient(135deg, rgba(15, 23, 42, 0.98) 0%, rgba(30, 41, 59, 0.98) 100%);
    border: 1px solid rgba(96, 165, 250, 0.3);
    border-radius: 1rem;
    padding: 1.5rem;
    transform: translateX(320px);
    transition: transform 0.4s ease;
    z-index: 20;
    backdrop-filter: blur(20px);
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
  }

  .threat-info-panel.active {
    transform: translateX(0);
  }

  .info-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid rgba(96, 165, 250, 0.2);
  }

  .info-header h4 {
    color: #60a5fa;
    margin: 0;
    font-size: 1.125rem;
    font-weight: 600;
  }

  .info-close {
    color: #ef4444;
    font-size: 1.5rem;
    cursor: pointer;
    line-height: 1;
    transition: color 0.3s ease;
  }

  .info-close:hover {
    color: #dc2626;
  }

  .threat-stats {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .stat-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem;
    background: rgba(96, 165, 250, 0.05);
    border-radius: 0.5rem;
    border: 1px solid rgba(96, 165, 250, 0.1);
  }

  .stat-label {
    color: rgba(226, 232, 240, 0.8);
    font-size: 0.875rem;
    font-weight: 500;
  }

  .stat-value {
    color: #60a5fa;
    font-weight: 700;
    font-size: 1rem;
  }

  @keyframes dash {
    to {
      stroke-dashoffset: -12;
    }
  }

  .command-header h3 {
    color: #e2e8f0;
    font-size: 1.75rem;
    font-weight: 700;
    margin: 0;
    background: linear-gradient(135deg, #60a5fa, #34d399, #fbbf24);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .premium-badge {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: linear-gradient(135deg, #fbbf24, #f59e0b);
    padding: 0.5rem 1rem;
    border-radius: 9999px;
    border: 1px solid rgba(251, 191, 36, 0.3);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 0 20px rgba(251, 191, 36, 0.3);
  }

  .premium-icon {
    font-size: 1.25rem;
    animation: bounce 2s infinite;
  }

  .premium-badge span:last-child {
    color: #1f2937;
    font-weight: 700;
    font-size: 0.875rem;
    letter-spacing: 0.05em;
  }

  .command-insights {
    margin-top: 2rem;
  }

  .insight-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 1.5rem;
  }

  .insight-card.premium {
    background: rgba(15, 23, 42, 0.8);
    border: 1px solid rgba(96, 165, 250, 0.2);
    border-radius: 1rem;
    padding: 1.5rem;
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .insight-card.premium::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(96, 165, 250, 0.5), transparent);
  }

  .insight-card.premium:hover {
    transform: translateY(-2px);
    border-color: rgba(96, 165, 250, 0.4);
    box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1), 0 0 30px rgba(96, 165, 250, 0.1);
  }

  .insight-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid rgba(148, 163, 184, 0.1);
  }

  .insight-header h4 {
    color: #e2e8f0;
    font-size: 1rem;
    font-weight: 600;
    margin: 0;
  }

  .insight-status {
    padding: 0.25rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .insight-status.active {
    background: rgba(34, 197, 94, 0.2);
    color: #22c55e;
    border: 1px solid rgba(34, 197, 94, 0.3);
  }

  .insight-status.monitoring {
    background: rgba(59, 130, 246, 0.2);
    color: #3b82f6;
    border: 1px solid rgba(59, 130, 246, 0.3);
  }

  .insight-status.critical {
    background: rgba(239, 68, 68, 0.2);
    color: #ef4444;
    border: 1px solid rgba(239, 68, 68, 0.3);
    animation: pulse 2s infinite;
  }

  .activity-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 0;
    border-bottom: 1px solid rgba(148, 163, 184, 0.1);
  }

  .activity-item:last-child {
    border-bottom: none;
  }

  .country-flag {
    font-size: 1.25rem;
  }

  .country-name {
    color: #e2e8f0;
    font-weight: 500;
    min-width: 60px;
  }

  .activity-bar {
    flex: 1;
    height: 6px;
    background: rgba(148, 163, 184, 0.2);
    border-radius: 3px;
    overflow: hidden;
  }

  .activity-fill {
    height: 100%;
    background: linear-gradient(90deg, #60a5fa, #34d399);
    border-radius: 3px;
    transition: width 0.5s ease;
  }

  .activity-value {
    color: #60a5fa;
    font-weight: 600;
    font-size: 0.875rem;
    min-width: 40px;
    text-align: right;
  }

  .vector-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 0;
    border-bottom: 1px solid rgba(148, 163, 184, 0.1);
  }

  .vector-item:last-child {
    border-bottom: none;
  }

  .vector-icon {
    font-size: 1.25rem;
  }

  .vector-name {
    color: #e2e8f0;
    font-weight: 500;
    flex: 1;
  }

  .vector-count {
    color: #f59e0b;
    font-weight: 600;
    background: rgba(245, 158, 11, 0.1);
    padding: 0.25rem 0.5rem;
    border-radius: 0.375rem;
    font-size: 0.875rem;
  }

  .vector-trend {
    font-size: 1rem;
  }

  .emerging-threat {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 0;
    border-bottom: 1px solid rgba(148, 163, 184, 0.1);
  }

  .emerging-threat:last-child {
    border-bottom: none;
  }

  .threat-icon {
    font-size: 1.25rem;
  }

  .threat-info {
    flex: 1;
  }

  .threat-name {
    display: block;
    color: #e2e8f0;
    font-weight: 500;
    margin-bottom: 0.25rem;
  }

  .threat-count {
    display: block;
    color: #94a3b8;
    font-size: 0.875rem;
  }

  /* Fuentes de Inteligencia Premium */
  .intelligence-sources {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  .intelligence-sources h3 {
    text-align: center;
    margin-bottom: 1rem;
    background: linear-gradient(135deg, #60a5fa, #34d399);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .intelligence-sources p {
    text-align: center;
    color: #6b7280;
    margin-bottom: 3rem;
    font-size: 1.125rem;
  }

  .source-card.premium {
    position: relative;
    background: linear-gradient(135deg, rgba(96, 165, 250, 0.05), rgba(52, 211, 153, 0.05));
    border: 1px solid rgba(96, 165, 250, 0.2);
    transition: all 0.3s ease;
  }

  .source-card.premium::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, #60a5fa, #34d399);
  }

  .source-card.premium:hover {
    transform: translateY(-4px);
    border-color: rgba(96, 165, 250, 0.4);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 0 40px rgba(96, 165, 250, 0.1);
  }

  .source-status {
    background: rgba(34, 197, 94, 0.1);
    color: #22c55e;
    border: 1px solid rgba(34, 197, 94, 0.3);
    animation: pulse 3s infinite;
  }

  /* Animaciones */
  @keyframes shimmer {
    0% {
      transform: translateX(-100%);
    }
    100% {
      transform: translateX(100%);
    }
  }

  @keyframes bounce {
    0%, 20%, 53%, 80%, 100% {
      transform: translate3d(0,0,0);
    }
    40%, 43% {
      transform: translate3d(0, -8px, 0);
    }
    70% {
      transform: translate3d(0, -4px, 0);
    }
    90% {
      transform: translate3d(0, -2px, 0);
    }
  }

  @keyframes pulse {
    0%, 100% {
      opacity: 1;
    }
    50% {
      opacity: 0.7;
    }
  }

  /* Centro de An√°lisis Inteligente */
  .intelligent-analysis-center {
    background: linear-gradient(135deg, rgba(10, 25, 50, 0.95), rgba(20, 40, 80, 0.9));
    border-radius: 25px;
    padding: 3rem;
    border: 2px solid rgba(0, 255, 255, 0.3);
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.1);
    margin-top: 2rem;
    position: relative;
    overflow: hidden;
  }

  .intelligent-analysis-center::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, transparent, #00ffff, #0088ff, #00ffff, transparent);
    animation: scanline 4s linear infinite;
  }

  .analysis-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 3rem;
    padding-bottom: 1.5rem;
    border-bottom: 2px solid rgba(0, 255, 255, 0.2);
  }

  .analysis-header h3 {
    font-size: 2rem;
    font-weight: 800;
    color: #00ffff;
    margin: 0;
    text-shadow: 0 0 20px rgba(0, 255, 255, 0.6);
    letter-spacing: 1px;
  }

  .analysis-status {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    background: rgba(0, 255, 0, 0.1);
    padding: 0.75rem 1.5rem;
    border-radius: 25px;
    border: 2px solid rgba(0, 255, 0, 0.3);
    font-weight: 600;
    color: #00ff00;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .status-indicator {
    width: 12px;
    height: 12px;
    background: #00ff00;
    border-radius: 50%;
    animation: pulse 1.2s ease-in-out infinite;
    box-shadow: 0 0 15px #00ff00;
  }

  .analysis-dashboard {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 2rem;
  }

  .analysis-panel {
    background: rgba(0, 0, 0, 0.4);
    border-radius: 20px;
    padding: 2rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(15px);
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .analysis-panel::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--panel-color);
    opacity: 0.8;
  }

  .analysis-panel.primary {
    --panel-color: linear-gradient(90deg, #ff4444, #ff6666);
    border-color: rgba(255, 68, 68, 0.3);
  }

  .analysis-panel.secondary {
    --panel-color: linear-gradient(90deg, #00ffff, #0088ff);
    border-color: rgba(0, 255, 255, 0.3);
  }

  .analysis-panel.tertiary {
    --panel-color: linear-gradient(90deg, #ffaa00, #ff8800);
    border-color: rgba(255, 170, 0, 0.3);
  }

  .analysis-panel.quaternary {
    --panel-color: linear-gradient(90deg, #8800ff, #aa00ff);
    border-color: rgba(136, 0, 255, 0.3);
  }

  .analysis-panel:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
  }

  .panel-title {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .panel-title h4 {
    margin: 0;
    font-size: 1.3rem;
    font-weight: 700;
    color: #ffffff;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .panel-icon {
    font-size: 1.5rem;
    filter: drop-shadow(0 0 8px currentColor);
  }

  .panel-badge {
    background: var(--panel-color);
    color: #000;
    padding: 0.4rem 1rem;
    border-radius: 15px;
    font-size: 0.7rem;
    font-weight: 800;
    letter-spacing: 1px;
    text-transform: uppercase;
  }

  /* Vectores de Ataque Premium */
  .vector-analytics {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .vector-item-premium {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 15px;
    padding: 1.5rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
  }

  .vector-item-premium:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: translateX(5px);
  }

  .vector-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
  }

  .vector-name {
    font-size: 1.1rem;
    font-weight: 600;
    color: #ffffff;
  }

  .vector-threat-level {
    padding: 0.3rem 0.8rem;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: 700;
    letter-spacing: 0.5px;
    text-transform: uppercase;
  }

  .vector-threat-level.critical {
    background: #ff4444;
    color: #000;
  }

  .vector-threat-level.high {
    background: #ff8800;
    color: #000;
  }

  .vector-threat-level.medium {
    background: #ffaa00;
    color: #000;
  }

  .vector-bar-premium {
    height: 8px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 0.75rem;
  }

  .vector-progress-premium {
    height: 100%;
    border-radius: 4px;
    transition: width 0.8s ease;
    position: relative;
  }

  .vector-progress-premium[data-level="critical"] {
    background: linear-gradient(90deg, #ff4444, #ff6666);
    box-shadow: 0 0 10px rgba(255, 68, 68, 0.5);
  }

  .vector-progress-premium[data-level="high"] {
    background: linear-gradient(90deg, #ff8800, #ffaa00);
    box-shadow: 0 0 10px rgba(255, 136, 0, 0.5);
  }

  .vector-progress-premium[data-level="medium"] {
    background: linear-gradient(90deg, #ffaa00, #ffcc00);
    box-shadow: 0 0 10px rgba(255, 170, 0, 0.5);
  }

  .vector-stats {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .vector-percentage {
    font-size: 1.2rem;
    font-weight: 700;
    color: #00ffff;
  }

  .vector-trend {
    font-size: 0.9rem;
    font-weight: 600;
    color: rgba(255, 255, 255, 0.8);
  }

  /* Geolocalizaci√≥n Premium */
  .geo-analytics {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .geo-item-premium {
    display: flex;
    align-items: center;
    gap: 1rem;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 12px;
    padding: 1rem;
    border: 1px solid rgba(255, 255, 255, 0.05);
    transition: all 0.3s ease;
  }

  .geo-item-premium:hover {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(0, 255, 255, 0.3);
  }

  .geo-flag {
    font-size: 1.5rem;
    width: 30px;
    text-align: center;
  }

  .geo-info {
    flex: 1;
  }

  .geo-country {
    display: block;
    font-weight: 600;
    color: #ffffff;
    margin-bottom: 0.5rem;
  }

  .geo-metrics {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .geo-bar {
    flex: 1;
    height: 6px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
    overflow: hidden;
  }

  .geo-progress {
    height: 100%;
    background: linear-gradient(90deg, #00ffff, #0088ff);
    border-radius: 3px;
    transition: width 0.6s ease;
  }

  .geo-percentage {
    font-weight: 600;
    color: #00ffff;
    min-width: 40px;
  }

  .geo-status {
    text-align: right;
  }

  .geo-incidents {
    display: block;
    font-size: 1.1rem;
    font-weight: 700;
    color: #ff8800;
  }

  .geo-label {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.6);
  }

  /* TTPs Premium */
  .ttp-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
  }

  .ttp-item {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    padding: 1.5rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    align-items: center;
    gap: 1rem;
    transition: all 0.3s ease;
  }

  .ttp-item:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: translateY(-2px);
  }

  .ttp-icon {
    font-size: 1.8rem;
    filter: drop-shadow(0 0 5px currentColor);
  }

  .ttp-details {
    flex: 1;
  }

  .ttp-name {
    display: block;
    font-weight: 600;
    color: #ffffff;
    margin-bottom: 0.25rem;
  }

  .ttp-id {
    display: block;
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.6);
    margin-bottom: 0.5rem;
  }

  .ttp-metrics {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .ttp-count {
    font-weight: 700;
    color: #00ffff;
  }

  .ttp-severity {
    font-size: 1.2rem;
  }

  .ttp-severity.critical {
    color: #ff4444;
  }

  .ttp-severity.high {
    color: #ff8800;
  }

  .ttp-severity.medium {
    color: #ffaa00;
  }

  /* An√°lisis Predictivo */
  .prediction-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 1.5rem;
  }

  .prediction-item {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 15px;
    padding: 1.5rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
    text-align: center;
    transition: all 0.3s ease;
  }

  .prediction-item:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: scale(1.02);
  }

  .prediction-label {
    display: block;
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.8);
    margin-bottom: 1rem;
    font-weight: 500;
  }

  .prediction-visual {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1rem;
  }

  .prediction-bar {
    width: 30px;
    height: 80px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    overflow: hidden;
    position: relative;
  }

  .prediction-fill {
    width: 100%;
    border-radius: 15px;
    position: absolute;
    bottom: 0;
    transition: height 0.8s ease;
  }

  .prediction-fill[data-trend="up"] {
    background: linear-gradient(to top, #00ff00, #00ffff);
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
  }

  .prediction-fill[data-trend="down"] {
    background: linear-gradient(to top, #ff4444, #ff8800);
    box-shadow: 0 0 15px rgba(255, 68, 68, 0.5);
  }

  .prediction-value {
    font-size: 1.2rem;
    font-weight: 700;
    color: #00ffff;
  }

  .prediction-confidence {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(0, 0, 0, 0.3);
    padding: 0.5rem;
    border-radius: 8px;
    border-top: 2px solid rgba(136, 0, 255, 0.5);
  }

  .confidence-label {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.6);
  }

  .confidence-value {
    font-weight: 700;
    color: #8800ff;
  }

  /* Responsive para Centro de Comando Premium */
  @media (max-width: 1200px) {
    .dashboard-grid {
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    }
    
    .analysis-dashboard {
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    }
  }

  @media (max-width: 768px) {
    .command-header {
      flex-direction: column;
      gap: 1rem;
      align-items: flex-start;
    }

    .command-header h3 {
      font-size: 1.5rem;
    }

    .insight-grid {
      grid-template-columns: 1fr;
    }

    .premium-command-center {
      padding: 1.5rem;
    }

    .intelligent-analysis-center {
      padding: 1.5rem;
    }

    .analysis-header {
      flex-direction: column;
      gap: 1rem;
      align-items: flex-start;
    }

    .analysis-header h3 {
      font-size: 1.5rem;
    }

    .analysis-dashboard {
      grid-template-columns: 1fr;
    }

    .panel-title {
      flex-direction: column;
      gap: 0.5rem;
      align-items: flex-start;
    }

    .panel-controls {
      flex-direction: column;
      gap: 1rem;
      align-items: stretch;
    }

    .export-controls {
      justify-content: center;
    }

    .vector-details-premium {
      grid-template-columns: 1fr;
    }

    .prediction-grid {
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    }
  }

  @media (max-width: 480px) {
    .dashboard-grid {
      grid-template-columns: 1fr;
      gap: 1rem;
    }

    .metric-card-premium {
      padding: 1rem;
    }

    .metric-value-premium {
      font-size: 1.8rem;
    }

    .export-controls {
      flex-direction: column;
      gap: 0.5rem;
    }

    .export-btn, .alert-btn {
      width: 100%;
      text-align: center;
    }

    .prediction-grid {
      grid-template-columns: 1fr;
    }

    .prediction-bar {
      height: 60px;
    }
  }

  /* Optimizaciones de rendimiento */
  .metric-card-premium,
  .vector-item-premium,
  .prediction-item {
    will-change: transform;
    backface-visibility: hidden;
    transform: translateZ(0);
  }

  .metric-card-premium:hover,
  .vector-item-premium:hover,
  .prediction-item:hover {
    transform: translateZ(0) translateY(-3px);
  }

  /* Preload cr√≠tico */
  .dashboard-grid,
  .analysis-dashboard {
    contain: layout style;
  }

  /* Optimizaci√≥n de animaciones */
  @media (prefers-reduced-motion: reduce) {
    .pulse-indicator,
    .metric-card-premium,
    .vector-item-premium,
    .prediction-item {
      animation: none;
      transition: none;
    }
  }

  /* Lazy loading optimization */
  img {
    loading: lazy;
    decoding: async;
  }

  /* Critical resource hints */
  .premium-threat-map,
  .dashboard-grid {
    content-visibility: auto;
    contain-intrinsic-size: 400px;
  }

  /* Estilos para mapa a ancho completo */
  .fullwidth-map-section {
    width: 100vw;
    height: 80vh;
    min-height: 600px;
    margin: 0;
    padding: 0;
    position: relative;
    left: 50%;
    right: 50%;
    margin-left: -50vw;
    margin-right: -50vw;
    background: #0f172a;
    overflow: hidden;
  }

  .fullwidth-map-container {
    width: 100%;
    height: 100%;
    position: relative;
  }

  .fullwidth-map-container #map-container {
    width: 100%;
    height: 100%;
    border-radius: 0;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .fullwidth-map-section {
      height: 60vh;
      min-height: 400px;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Debug: Verificar elementos del mapa
    console.log('üîç Iniciando diagn√≥stico del mapa de amenazas...');
    
    const threatPoints = document.querySelectorAll('.threat-point');
    const attackLines = document.querySelectorAll('.attack-line');
    const worldMap = document.querySelector('.world-map');
    
    console.log(`üìç Puntos de amenaza encontrados: ${threatPoints.length}`);
    console.log(`üîó L√≠neas de ataque encontradas: ${attackLines.length}`);
    console.log(`üó∫Ô∏è Mapa SVG encontrado:`, worldMap ? 'S√≠' : 'No');
    
    // Verificar atributos data-region
    threatPoints.forEach((point, index) => {
      const region = point.getAttribute('data-region');
      const type = point.getAttribute('data-type');
      const count = point.getAttribute('data-count');
      console.log(`   Punto ${index + 1}: regi√≥n=${region}, tipo=${type}, count=${count}`);
    });
    
    // Verificar visibilidad de elementos
     if (worldMap) {
       const mapRect = worldMap.getBoundingClientRect();
       console.log(`üó∫Ô∏è Dimensiones del mapa: ${mapRect.width}x${mapRect.height}`);
     }
     
     // Debug espec√≠fico para l√≠neas de ataque
     attackLines.forEach((line, index) => {
       const x1 = line.getAttribute('x1');
       const y1 = line.getAttribute('y1');
       const x2 = line.getAttribute('x2');
       const y2 = line.getAttribute('y2');
       const stroke = line.getAttribute('stroke');
       const strokeWidth = line.getAttribute('stroke-width');
       
       console.log(`üîó L√≠nea ${index + 1}: (${x1},${y1}) ‚Üí (${x2},${y2}), stroke: ${stroke}, width: ${strokeWidth}`);
       
       // Verificar si la l√≠nea es visible
       const computedStyle = window.getComputedStyle(line);
       console.log(`   Visibilidad: opacity=${computedStyle.opacity}, display=${computedStyle.display}`);
       
       // Agregar outline temporal para debugging
       line.style.strokeWidth = '3';
       line.style.stroke = '#ff0000';
       line.style.opacity = '1';
       
       // Restaurar despu√©s de 3 segundos
        setTimeout(() => {
          line.style.strokeWidth = strokeWidth;
          line.style.stroke = stroke;
          line.style.opacity = '';
        }, 3000);
      });
    
    // Funcionalidad de exportaci√≥n y alertas
    const exportPDFBtn = document.getElementById('exportPDF');
    const exportExcelBtn = document.getElementById('exportExcel');
    const configAlertsBtn = document.getElementById('configAlerts');

    if (exportPDFBtn) {
      exportPDFBtn.addEventListener('click', function() {
        // Simular exportaci√≥n PDF
        this.textContent = 'üìÑ Generando...';
        this.disabled = true;
        
        setTimeout(() => {
          // Crear y descargar un archivo de ejemplo
          const reportData = `Reporte de Amenazas - ${new Date().toLocaleDateString('es-ES')}\n\n` +
            `Nivel de Amenaza Global: Alto\n` +
            `Puntuaci√≥n: 78/100\n\n` +
            `Amenazas de Malware: +14%\n` +
            `Tr√°fico Malicioso: 9%\n` +
            `Grupos de Ransomware Activos: 68\n\n` +
            `Generado el: ${new Date().toLocaleString('es-ES')}`;
          
          const blob = new Blob([reportData], { type: 'text/plain' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `reporte-amenazas-${new Date().toISOString().split('T')[0]}.txt`;
          a.click();
          URL.revokeObjectURL(url);
          
          this.textContent = 'üìÑ PDF';
          this.disabled = false;
        }, 2000);
      });
    }

    if (exportExcelBtn) {
      exportExcelBtn.addEventListener('click', function() {
        this.textContent = 'üìä Procesando...';
        this.disabled = true;
        
        setTimeout(() => {
          // Crear datos CSV
          const csvData = [
            ['M√©trica', 'Valor', 'Fecha'],
            ['Amenazas de Malware', '+14%', new Date().toLocaleDateString('es-ES')],
            ['Tr√°fico Malicioso (%)', '9%', new Date().toLocaleDateString('es-ES')],
            ['Grupos de Ransomware', '68', new Date().toLocaleDateString('es-ES')],
            ['Nivel de Amenaza', 'Alto', new Date().toLocaleDateString('es-ES')],
            ['Puntuaci√≥n Global', '78/100', new Date().toLocaleDateString('es-ES')]
          ].map(row => row.join(',')).join('\n');
          
          const blob = new Blob([csvData], { type: 'text/csv' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `datos-amenazas-${new Date().toISOString().split('T')[0]}.csv`;
          a.click();
          URL.revokeObjectURL(url);
          
          this.textContent = 'üìä Excel';
          this.disabled = false;
        }, 1500);
      });
    }

    if (configAlertsBtn) {
       configAlertsBtn.addEventListener('click', function() {
         const alertConfig = prompt(
           'Configurar Alertas de Amenazas:\n\n' +
           '1. Umbral de amenaza (1-100): ',
           '70'
         );
         
         if (alertConfig && !isNaN(alertConfig)) {
           const threshold = parseInt(alertConfig);
           if (threshold >= 1 && threshold <= 100) {
             localStorage.setItem('threatAlertThreshold', threshold);
             alert(`Alerta configurada: Se notificar√° cuando el nivel de amenaza supere ${threshold}/100`);
             
             // Verificar si el nivel actual supera el umbral
             if (78 >= threshold) {
               setTimeout(() => {
                 alert(`üö® ALERTA: Nivel de amenaza actual (78/100) supera el umbral configurado!`);
               }, 1000);
             }
           } else {
             alert('Por favor, ingrese un valor entre 1 y 100');
           }
         }
       });
     }

     // Mejorar interactividad con animaciones fluidas
     const metricCards = document.querySelectorAll('.metric-card-premium');
     metricCards.forEach(card => {
       card.addEventListener('mouseenter', function() {
         this.style.transform = 'translateY(-5px) scale(1.02)';
         this.style.boxShadow = '0 15px 40px rgba(0, 0, 0, 0.4)';
       });
       
       card.addEventListener('mouseleave', function() {
         this.style.transform = 'translateY(0) scale(1)';
         this.style.boxShadow = '0 5px 20px rgba(0, 0, 0, 0.2)';
       });
     });

     // Animaci√≥n de contadores
     const animateCounters = () => {
       const counters = document.querySelectorAll('.metric-value-premium');
       counters.forEach(counter => {
         const target = parseInt(counter.textContent.replace(/[^0-9]/g, ''));
         if (target) {
           let current = 0;
           const increment = target / 50;
           const timer = setInterval(() => {
             current += increment;
             if (current >= target) {
               current = target;
               clearInterval(timer);
             }
             counter.textContent = counter.textContent.replace(/\d+/, Math.floor(current));
           }, 30);
         }
       });
     };

     // Ejecutar animaci√≥n de contadores despu√©s de un breve delay
     setTimeout(animateCounters, 500);

     // Efecto de pulsaci√≥n para elementos cr√≠ticos
     const criticalElements = document.querySelectorAll('.metric-card-premium.critical');
     criticalElements.forEach(element => {
       setInterval(() => {
         element.style.boxShadow = '0 0 20px rgba(255, 68, 68, 0.8)';
         setTimeout(() => {
           element.style.boxShadow = '0 5px 20px rgba(0, 0, 0, 0.2)';
         }, 500);
       }, 3000);
     });

     // Funcionalidad del Mapa Interactivo
     const threatData = {
       'north-america': { threats: 156, risk: 'Alto', type: 'Ransomware' },
       'europe': { threats: 89, risk: 'Medio', type: 'Malware' },
       'asia': { threats: 234, risk: 'Cr√≠tico', type: 'Phishing' },
       'africa': { threats: 45, risk: 'Bajo', type: 'Malware' },
       'south-america': { threats: 78, risk: 'Medio', type: 'Ransomware' },
       'oceania': { threats: 23, risk: 'Bajo', type: 'Phishing' }
     };

     // Filtros del mapa
     document.querySelectorAll('.map-filter').forEach(filter => {
       filter.addEventListener('click', function() {
         document.querySelectorAll('.map-filter').forEach(f => f.classList.remove('active'));
         this.classList.add('active');
         
         const filterType = this.dataset.filter;
         const threatPoints = document.querySelectorAll('.threat-point');
         
         threatPoints.forEach(point => {
           if (filterType === 'all' || point.dataset.type === filterType) {
             point.style.display = 'block';
             point.style.opacity = '1';
           } else {
             point.style.opacity = '0.2';
           }
         });
       });
     });

     // Interacci√≥n con continentes
     document.querySelectorAll('.continent').forEach(continent => {
       continent.addEventListener('click', function() {
         const region = this.dataset.region;
         const data = threatData[region];
         
         if (data) {
           showThreatInfo(region, data);
         }
       });
     });

     // Interacci√≥n con puntos de amenaza
     document.querySelectorAll('.threat-point').forEach((point, index) => {
       point.addEventListener('click', function(e) {
         console.log(`üéØ Click en punto de amenaza ${index + 1}:`, this);
         
         const type = this.dataset.type;
         const count = this.dataset.count;
         const region = this.dataset.region;
         
         console.log(`   Regi√≥n: ${region}, Tipo: ${type}, Count: ${count}`);
         
         const panel = document.getElementById('threatInfoPanel');
         const regionName = document.getElementById('regionName');
         const activeThreats = document.getElementById('activeThreats');
         const riskLevel = document.getElementById('riskLevel');
         const dominantType = document.getElementById('dominantType');
         
         if (!panel) {
           console.error('‚ùå Panel de informaci√≥n no encontrado');
           return;
         }
         
         regionName.textContent = `Amenaza ${type.charAt(0).toUpperCase() + type.slice(1)}`;
         activeThreats.textContent = count;
         riskLevel.textContent = count > 150 ? 'Cr√≠tico' : count > 80 ? 'Alto' : count > 40 ? 'Medio' : 'Bajo';
         dominantType.textContent = type.charAt(0).toUpperCase() + type.slice(1);
         
         panel.classList.add('active');
         console.log('‚úÖ Panel de informaci√≥n activado');
         
         // Prevenir propagaci√≥n del evento
         e.stopPropagation();
       });
       
       // Agregar estilo visual para debugging
        point.style.cursor = 'pointer';
        point.style.outline = '1px solid rgba(255,255,255,0.3)';
      });

     // Funci√≥n para mostrar informaci√≥n de amenazas
     function showThreatInfo(region, data) {
       const panel = document.getElementById('threatInfoPanel');
       const regionName = document.getElementById('regionName');
       const activeThreats = document.getElementById('activeThreats');
       const riskLevel = document.getElementById('riskLevel');
       const dominantType = document.getElementById('dominantType');
       
       const regionNames = {
         'north-america': 'Am√©rica del Norte',
         'europe': 'Europa',
         'asia': 'Asia',
         'africa': '√Åfrica',
         'south-america': 'Am√©rica del Sur',
         'oceania': 'Ocean√≠a'
       };
       
       regionName.textContent = regionNames[region] || region;
       activeThreats.textContent = data.threats;
       riskLevel.textContent = data.risk;
       dominantType.textContent = data.type;
       
       panel.classList.add('active');
     }

     // Cerrar panel de informaci√≥n
     const closeBtn = document.getElementById('closeInfo');
     if (closeBtn) {
       closeBtn.addEventListener('click', function() {
         document.getElementById('threatInfoPanel').classList.remove('active');
       });
     }

     // Cerrar panel al hacer clic fuera
     document.addEventListener('click', function(e) {
       const panel = document.getElementById('threatInfoPanel');
       const map = document.querySelector('.interactive-threat-map');
       
       if (panel && !panel.contains(e.target) && map && !map.contains(e.target)) {
         panel.classList.remove('active');
       }
     });

     // Sistema de actualizaciones en tiempo real
     class RealTimeThreatUpdater {
       constructor() {
         this.updateInterval = 15 * 60 * 1000; // 15 minutos
         this.isUpdating = false;
         this.lastUpdate = null;
         this.init();
       }

       async init() {
         // Actualizaci√≥n inicial despu√©s de 30 segundos
         setTimeout(() => this.updateThreatData(), 30000);
         
         // Configurar actualizaciones peri√≥dicas
         setInterval(() => this.updateThreatData(), this.updateInterval);
         
         // Agregar indicador de estado
         this.addUpdateIndicator();
       }

       addUpdateIndicator() {
         const indicator = document.createElement('div');
         indicator.id = 'updateIndicator';
         indicator.innerHTML = `
           <div class="update-status">
             <span class="status-dot"></span>
             <span class="status-text">Datos en tiempo real</span>
             <span class="last-update">√öltima actualizaci√≥n: Cargando...</span>
           </div>
         `;
         indicator.style.cssText = `
           position: fixed;
           top: 20px;
           right: 20px;
           background: rgba(15, 23, 42, 0.9);
           color: white;
           padding: 10px 15px;
           border-radius: 8px;
           font-size: 12px;
           z-index: 1000;
           border: 1px solid rgba(255, 255, 255, 0.1);
         `;
         
         const statusDot = indicator.querySelector('.status-dot');
         statusDot.style.cssText = `
           display: inline-block;
           width: 8px;
           height: 8px;
           background: #10b981;
           border-radius: 50%;
           margin-right: 8px;
           animation: pulse 2s infinite;
         `;
         
         document.body.appendChild(indicator);
       }

       async updateThreatData() {
         if (this.isUpdating) return;
         
         this.isUpdating = true;
         this.updateStatus('updating', 'Actualizando datos...');
         
         try {
           const response = await fetch('/api/cybersecurity.json');
           if (!response.ok) throw new Error(`HTTP ${response.status}`);
           
           const data = await response.json();
           if (data.success && data.data) {
             this.processNewData(data.data);
             this.lastUpdate = new Date();
             this.updateStatus('success', `√öltima actualizaci√≥n: ${this.lastUpdate.toLocaleTimeString()}`);
           } else {
             throw new Error('Datos inv√°lidos recibidos');
           }
         } catch (error) {
           console.warn('Error actualizando datos de amenazas:', error);
           this.updateStatus('error', 'Error en actualizaci√≥n');
         } finally {
           this.isUpdating = false;
         }
       }

       processNewData(apiData) {
         // Mapear datos de APIs a regiones del mapa
         const regionMapping = {
           'north-america': this.calculateRegionThreats(apiData, 'US'),
           'europe': this.calculateRegionThreats(apiData, 'EU'),
           'asia': this.calculateRegionThreats(apiData, 'AS'),
           'africa': this.calculateRegionThreats(apiData, 'AF'),
           'south-america': this.calculateRegionThreats(apiData, 'SA'),
           'australia': this.calculateRegionThreats(apiData, 'OC')
         };

         // Actualizar puntos de amenaza
         Object.entries(regionMapping).forEach(([region, data]) => {
           this.updateThreatPoint(region, data);
         });

         // Actualizar estad√≠sticas globales
         this.updateGlobalStats(apiData);
       }

       calculateRegionThreats(apiData, regionCode) {
         let totalThreats = 0;
         let threatType = 'malware';
         let riskLevel = 'medium';

         // Procesar datos de URLhaus
         if (apiData.urlhaus && apiData.urlhaus.topCountries) {
           const regionData = apiData.urlhaus.topCountries.find(c => 
             this.getRegionFromCountry(c.country) === regionCode
           );
           if (regionData) {
             totalThreats += regionData.count || 0;
           }
         }

         // Procesar datos de SANS ISC
         if (apiData.sansISC && apiData.sansISC.ports) {
           totalThreats += Math.floor((apiData.sansISC.ports.length || 0) * Math.random() * 50);
         }

         // Procesar datos de Ransomware
         if (apiData.ransomwatch && apiData.ransomwatch.recent_victims) {
           totalThreats += Math.floor(apiData.ransomwatch.recent_victims * Math.random() * 10);
           threatType = 'ransomware';
         }

         // Determinar nivel de riesgo
         if (totalThreats > 500) riskLevel = 'critical';
         else if (totalThreats > 200) riskLevel = 'high';
         else if (totalThreats > 50) riskLevel = 'medium';
         else riskLevel = 'low';

         return { count: totalThreats, type: threatType, risk: riskLevel };
       }

       getRegionFromCountry(countryCode) {
         const regionMap = {
           'US': 'US', 'CA': 'US', 'MX': 'US',
           'GB': 'EU', 'DE': 'EU', 'FR': 'EU', 'IT': 'EU', 'ES': 'EU',
           'CN': 'AS', 'JP': 'AS', 'KR': 'AS', 'IN': 'AS', 'RU': 'AS',
           'ZA': 'AF', 'NG': 'AF', 'EG': 'AF', 'KE': 'AF',
           'BR': 'SA', 'AR': 'SA', 'CL': 'SA', 'CO': 'SA',
           'AU': 'OC', 'NZ': 'OC'
         };
         return regionMap[countryCode] || 'EU';
       }

       updateThreatPoint(region, data) {
         const circles = document.querySelectorAll(`circle[data-region="${region}"]`);
         circles.forEach(circle => {
           // Actualizar contador
           circle.setAttribute('data-count', data.count.toLocaleString());
           
           // Actualizar tipo de amenaza
           circle.setAttribute('data-type', data.type);
           
           // Actualizar clase de riesgo
           circle.className = circle.className.replace(/\b(critical|high|medium|low)\b/g, data.risk);
           
           // Actualizar color basado en riesgo
           const colors = {
             critical: '#ef4444',
             high: '#f59e0b', 
             medium: '#eab308',
             low: '#10b981'
           };
           circle.setAttribute('fill', colors[data.risk] || colors.medium);
         });
       }

       updateGlobalStats(apiData) {
         // Actualizar contadores en las m√©tricas premium
         const updateCounter = (selector, value) => {
           const element = document.querySelector(selector);
           if (element) {
             const currentValue = parseInt(element.textContent.replace(/[^\d]/g, '')) || 0;
             this.animateCounter(element, currentValue, value);
           }
         };

         if (apiData.urlhaus) {
           updateCounter('.metric-card-premium:nth-child(1) .metric-number', 
             apiData.urlhaus.count || 0);
         }
         
         if (apiData.sansISC) {
           updateCounter('.metric-card-premium:nth-child(2) .metric-number', 
             apiData.sansISC.totalScans || 0);
         }
         
         if (apiData.ransomwatch) {
           updateCounter('.metric-card-premium:nth-child(3) .metric-number', 
             apiData.ransomwatch.recent_victims || 0);
         }
       }

       animateCounter(element, from, to) {
         const duration = 1000;
         const steps = 30;
         const increment = (to - from) / steps;
         let current = from;
         
         const timer = setInterval(() => {
           current += increment;
           if ((increment > 0 && current >= to) || (increment < 0 && current <= to)) {
             current = to;
             clearInterval(timer);
           }
           element.textContent = Math.floor(current).toLocaleString();
         }, duration / steps);
       }

       updateStatus(status, message) {
         const indicator = document.getElementById('updateIndicator');
         if (!indicator) return;
         
         const statusDot = indicator.querySelector('.status-dot');
         const statusText = indicator.querySelector('.last-update');
         
         const colors = {
           success: '#10b981',
           updating: '#f59e0b',
           error: '#ef4444'
         };
         
         if (statusDot) statusDot.style.background = colors[status] || colors.success;
         if (statusText) statusText.textContent = message;
       }
     }

     // Inicializar sistema de actualizaciones
     new RealTimeThreatUpdater();
   });
 </script>