---
export interface Props {
  title: string;
  description: string;
  canonical?: string;
  type?: 'website' | 'article' | 'service' | 'organization';
  image?: string;
  imageAlt?: string;
  lang?: 'es' | 'en';
  structuredData?: object;
  noindex?: boolean;
}

const {
  title,
  description,
  canonical,
  type = 'website',
  image = '/images/og-default.jpg',
  imageAlt = 'SESEC - Consultoría en Ciberseguridad',
  lang = 'es',
  structuredData,
  noindex = false
} = Astro.props;

const baseUrl = Astro.site || 'https://sesecpro.com';
const currentUrl = canonical || `${baseUrl}${Astro.url.pathname}`;
const fullImageUrl = image.startsWith('http') ? image : `${baseUrl}${image}`;

// Structured Data por defecto según el tipo
const getDefaultStructuredData = () => {
  const baseData = {
    '@context': 'https://schema.org',
    '@type': type === 'service' ? 'Service' : type === 'article' ? 'Article' : 'WebPage',
    name: title,
    description: description,
    url: currentUrl,
    image: fullImageUrl,
    inLanguage: lang,
    isPartOf: {
      '@type': 'WebSite',
      name: 'SESEC',
      url: baseUrl
    }
  };

  if (type === 'service') {
    return {
      ...baseData,
      '@type': 'Service',
      provider: {
        '@type': 'Organization',
        name: 'SESEC',
        url: baseUrl
      },
      serviceType: 'Cybersecurity Consulting',
      areaServed: {
        '@type': 'Country',
        name: 'Spain'
      }
    };
  }

  if (type === 'article') {
    return {
      ...baseData,
      '@type': 'Article',
      author: {
        '@type': 'Organization',
        name: 'SESEC'
      },
      publisher: {
        '@type': 'Organization',
        name: 'SESEC',
        logo: {
          '@type': 'ImageObject',
          url: `${baseUrl}/images/logo.svg`
        }
      },
      datePublished: new Date().toISOString(),
      dateModified: new Date().toISOString()
    };
  }

  return baseData;
};

const finalStructuredData = structuredData || getDefaultStructuredData();
---

<!-- SEO Meta Tags -->
<title>{title}</title>
<meta name="description" content={description} />
<link rel="canonical" href={currentUrl} />

{noindex && (
  <meta name="robots" content="noindex, nofollow" />
)}

<!-- Open Graph -->
<meta property="og:type" content={type === 'article' ? 'article' : 'website'} />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:url" content={currentUrl} />
<meta property="og:image" content={fullImageUrl} />
<meta property="og:image:alt" content={imageAlt} />
<meta property="og:site_name" content="SESEC" />
<meta property="og:locale" content={lang === 'es' ? 'es_ES' : 'en_US'} />

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@sesecpro" />
<meta name="twitter:creator" content="@sesecpro" />
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={fullImageUrl} />
<meta name="twitter:image:alt" content={imageAlt} />

<!-- Additional Meta Tags -->
<meta name="theme-color" content="#1a365d" />
<meta name="msapplication-TileColor" content="#1a365d" />

<!-- Structured Data -->
<script type="application/ld+json" set:html={JSON.stringify(finalStructuredData)} is:inline />

<!-- Breadcrumb Structured Data (si aplica) -->
{Astro.url.pathname !== '/' && (
  <script type="application/ld+json" is:inline>
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Inicio",
          "item": `${baseUrl}/`
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": title,
          "item": currentUrl
        }
      ]
    }
  </script>
)}

<!-- FAQ Structured Data (para páginas de servicios) -->
{type === 'service' && (
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "¿Qué incluye una auditoría de ciberseguridad?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Una auditoría completa incluye análisis de vulnerabilidades, revisión de políticas de seguridad, evaluación de controles técnicos y organizacionales, y un informe detallado con recomendaciones prioritizadas."
          }
        },
        {
          "@type": "Question",
          "name": "¿Cuánto tiempo toma completar una auditoría?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "El tiempo varía según el alcance, pero típicamente entre 2-6 semanas para organizaciones medianas, incluyendo planificación, ejecución y entrega del informe final."
          }
        },
        {
          "@type": "Question",
          "name": "¿Ofrecen servicios de seguimiento post-auditoría?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Sí, ofrecemos servicios de seguimiento para verificar la implementación de recomendaciones y auditorías de re-certificación según sea necesario."
          }
        }
      ]
    }
  </script>
)}